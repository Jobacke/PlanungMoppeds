<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JUH Motorradgruppe - Einsatzplanung 2025 v4.5 FIRESTORE-FIXED</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        window.firebaseModules = { initializeApp, getAuth, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where, orderBy };
        console.log('‚úÖ Firebase Module geladen');
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700;800&family=Roboto+Condensed:wght@400;700&display=swap');
        :root{--juh-red:#E30613;--juh-dark-red:#B30510;--juh-light-red:#FF1F2D;--juh-gray:#4A4A4A;--juh-light-gray:#F5F5F5;--juh-border:#E0E0E0;--text-dark:#2C2C2C;--text-light:#666;--success:#28A745;--warning:#FFC107;--info:#17A2B8;--admin-gold:#FFD700}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Barlow',sans-serif;background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%);color:var(--text-dark);min-height:100vh}
        .login-container{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem}
        .login-box{background:#fff;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.15);max-width:450px;width:100%;overflow:hidden}
        .login-header{background:linear-gradient(135deg,var(--juh-red) 0%,var(--juh-dark-red) 100%);color:#fff;padding:2.5rem 2rem;text-align:center}
        .login-header .logo-icon{width:80px;height:80px;background:#fff;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;font-weight:800;font-size:36px;color:var(--juh-red);margin-bottom:1rem;box-shadow:0 4px 12px rgba(0,0,0,.2)}
        .login-header h1{font-size:1.8rem;margin-bottom:.5rem}
        .login-header p{opacity:.95;font-size:1rem}
        .login-body{padding:2rem}
        .form-group{margin-bottom:1.5rem}
        .form-label{display:block;font-weight:600;margin-bottom:.5rem;color:var(--text-dark)}
        .form-label.required::after{content:' *';color:var(--juh-red)}
        .form-input,.form-select,.form-textarea{width:100%;padding:.875rem;border:2px solid var(--juh-border);border-radius:8px;font-size:1rem;font-family:'Barlow',sans-serif;transition:all .3s ease}
        .form-textarea{min-height:100px;resize:vertical}
        .form-input:focus,.form-select:focus,.form-textarea:focus{outline:0;border-color:var(--juh-red);box-shadow:0 0 0 3px rgba(227,6,19,.1)}
        .btn{padding:.875rem 1.5rem;border:none;border-radius:8px;font-weight:600;font-size:1rem;cursor:pointer;transition:all .3s ease;display:inline-flex;align-items:center;justify-content:center;gap:.5rem;font-family:'Barlow',sans-serif}
        .btn-primary{background:var(--juh-red);color:#fff;box-shadow:0 2px 8px rgba(227,6,19,.3)}
        .btn-primary:hover:not(:disabled){background:var(--juh-dark-red);transform:translateY(-1px);box-shadow:0 4px 12px rgba(227,6,19,.4)}
        .btn-primary:disabled{opacity:.6;cursor:not-allowed}
        .btn-secondary{background:var(--juh-gray);color:#fff}
        .btn-secondary:hover{background:#3a3a3a}
        .btn-success{background:var(--success);color:#fff}
        .btn-success:hover{background:#218838}
        .btn-danger{background:#dc3545;color:#fff}
        .btn-danger:hover{background:#c82333}
        .btn-google{background:#fff;color:var(--text-dark);border:2px solid var(--juh-border);margin-top:1rem;width:100%}
        .btn-google:hover{border-color:var(--juh-red);background:var(--juh-light-gray)}
        .divider{display:flex;align-items:center;text-align:center;margin:1.5rem 0;color:var(--text-light)}
        .divider::before,.divider::after{content:'';flex:1;border-bottom:1px solid var(--juh-border)}
        .divider span{padding:0 1rem;font-size:.9rem}
        .error-message,.success-message{padding:.875rem;border-radius:8px;margin-bottom:1rem;font-size:.9rem}
        .error-message{background:#f8d7da;border:1px solid #f5c6cb;color:#721c24}
        .success-message{background:#d4edda;border:1px solid #c3e6cb;color:#155724}
        .container{max-width:1600px;margin:0 auto;padding:0}
        .header{background:linear-gradient(135deg,var(--juh-red) 0%,var(--juh-dark-red) 100%);color:#fff;padding:1.5rem 2rem;box-shadow:0 4px 20px rgba(227,6,19,.3)}
        .header-content{display:flex;justify-content:space-between;align-items:center;max-width:1600px;margin:0 auto;flex-wrap:wrap;gap:1rem}
        .logo-section{display:flex;align-items:center;gap:1rem}
        .logo-icon{width:50px;height:50px;background:#fff;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:24px;color:var(--juh-red);font-family:'Roboto Condensed',sans-serif}
        .header-title h1{font-size:1.8rem;font-weight:800}
        .header-title .subtitle{font-size:.9rem;opacity:.95}
        .header-actions{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}
        .user-info{display:flex;align-items:center;gap:1rem;background:rgba(255,255,255,.1);padding:.75rem 1.25rem;border-radius:8px}
        .user-email{font-size:.9rem}.admin-badge{background:var(--admin-gold);color:#000;padding:.25rem .75rem;border-radius:12px;font-size:.8rem;font-weight:700;margin-left:.5rem}
        .btn-logout{background:rgba(255,255,255,.2);color:#fff;padding:.5rem 1rem;border:1px solid rgba(255,255,255,.3);border-radius:6px;font-size:.9rem;cursor:pointer;transition:all .2s ease}
        .btn-logout:hover{background:rgba(255,255,255,.3)}
        .btn-header{background:#fff;color:var(--juh-red);padding:.75rem 1.5rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all .2s ease}
        .btn-header:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(255,255,255,.3)}
        .nav-tabs{background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.08);padding:0 2rem;display:flex;gap:.5rem;overflow-x:auto}
        .nav-tab{padding:1rem 1.5rem;border:none;background:0 0;color:var(--text-light);font-weight:600;cursor:pointer;position:relative;transition:all .3s ease;white-space:nowrap;font-family:'Barlow',sans-serif;font-size:.95rem}
        .nav-tab:hover{color:var(--juh-red)}
        .nav-tab.active{color:var(--juh-red)}
        .nav-tab.active::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:var(--juh-red)}
        .main-content{padding:2rem}
        .card{background:#fff;border-radius:12px;padding:1.5rem;box-shadow:0 2px 12px rgba(0,0,0,.06);margin-bottom:1.5rem}
        .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:2px solid var(--juh-light-gray);flex-wrap:wrap;gap:1rem}
        .card-title{font-size:1.4rem;font-weight:700;color:var(--text-dark)}
        .card-actions{display:flex;gap:.5rem;flex-wrap:wrap}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem}
        .stat-card{background:#fff;border-radius:12px;padding:1.5rem;box-shadow:0 2px 12px rgba(0,0,0,.06);border-left:4px solid var(--juh-red)}
        .stat-value{font-size:2.5rem;font-weight:800;color:var(--juh-red);margin-bottom:.5rem}
        .stat-label{font-size:.9rem;color:var(--text-light);font-weight:600;text-transform:uppercase}
        .table-container{overflow-x:auto;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.1)}
        .table{width:100%;border-collapse:collapse;background:#fff}
        .table thead{background:linear-gradient(135deg,var(--juh-red) 0%,var(--juh-dark-red) 100%);color:#fff}
        .table th{padding:1rem;text-align:left;font-weight:700;font-size:.9rem}
        .table td{padding:1rem;border-bottom:1px solid var(--juh-border);font-size:.95rem}
        .table tbody tr:hover{background:var(--juh-light-gray)}
        .badge{display:inline-block;padding:.35rem .75rem;border-radius:20px;font-size:.8rem;font-weight:600}
        .badge-pflicht{background:#ffe5e7;color:var(--juh-red)}
        .badge-optional{background:#e8f5e9;color:var(--success)}
        .badge-info{background:#e3f2fd;color:var(--info)}
        .badge-geplant{background:#fff3cd;color:#856404}
        .badge-abgeschlossen{background:#d4edda;color:#155724}
        .search-input{flex:1;min-width:250px;padding:.75rem 1rem;border:2px solid var(--juh-border);border-radius:8px;font-size:1rem;font-family:'Barlow',sans-serif}
        .search-input:focus{outline:0;border-color:var(--juh-red)}
        .action-btn{padding:.4rem .8rem;border:none;border-radius:6px;cursor:pointer;font-size:.85rem;font-weight:600;color:#fff;margin:0 .25rem;transition:all .2s ease}
        .action-btn-edit{background:var(--info)}
        .action-btn-delete{background:#dc3545}
        .action-btn-complete{background:var(--success)}
        .action-btn:hover{opacity:.8;transform:translateY(-1px)}
        .search-filter-bar{display:flex;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap}
        .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000;padding:2rem}
        .modal{background:#fff;border-radius:12px;max-width:800px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,.3)}
        .modal-header{padding:1.5rem;border-bottom:2px solid var(--juh-light-gray);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:#fff;z-index:10}
        .modal-title{font-size:1.4rem;font-weight:700;color:var(--juh-red)}
        .modal-close{background:0 0;border:none;font-size:1.5rem;cursor:pointer;color:var(--text-light);padding:.5rem}
        .modal-body{padding:1.5rem}
        .modal-footer{padding:1.5rem;border-top:2px solid var(--juh-light-gray);display:flex;gap:1rem;justify-content:flex-end;position:sticky;bottom:0;background:#fff}
        .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem}
        .form-grid-full{grid-column:1/-1}
        .checkbox-group{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:.75rem;margin-top:.5rem}
        .checkbox-item{display:flex;align-items:center;gap:.5rem;padding:.75rem;background:var(--juh-light-gray);border-radius:6px;cursor:pointer;transition:all .2s ease}
        .checkbox-item:hover{background:#e8e8e8}
        .checkbox-item input[type=checkbox]{width:18px;height:18px;cursor:pointer}
        .checkbox-item label{cursor:pointer;flex:1;font-weight:500}
        .export-options{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-top:1rem}
        .confirm-dialog{max-width:500px}
        .confirm-message{padding:2rem;text-align:center;font-size:1.1rem;line-height:1.6}
        .info-box{margin-top:2rem;padding:1rem;background:var(--juh-light-gray);border-radius:8px;border-left:4px solid var(--info)}
        @media (max-width:768px){
            .header-content{flex-direction:column}
            .main-content{padding:1rem}
            .stats-grid,.form-grid,.checkbox-group,.export-options{grid-template-columns:1fr}
        }
    </style>
    <!-- PDF & XLSX Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const firebaseConfig = {
            apiKey: "AIzaSyCf7t6bWBGND3nyxVy-PlO3nhcnimbyFbk",
            authDomain: "planungmoppeds.firebaseapp.com",
            projectId: "planungmoppeds",
            storageBucket: "planungmoppeds.firebasestorage.app",
            messagingSenderId: "258167919062",
            appId: "1:258167919062:web:c6d9f907ccd13a259f1477"
        };
        
        // ========================================
        // ADMIN CONFIGURATION
        // F√ºge hier Admin-Emails hinzu:
        // ========================================
        const ADMIN_EMAILS = [
            'johannes.backhaus@johanniter.de',
            'alexander.hofbauer@johanniter.de'
        ];
        
        const isAdmin = (userEmail) => {
            if (!userEmail) return false;
            return ADMIN_EMAILS.includes(userEmail.toLowerCase());
        };
        // ========================================
        
        let db=null,auth=null,firebaseApp=null;
        const initFirebase=()=>{try{const{initializeApp,getFirestore,getAuth}=window.firebaseModules;firebaseApp=initializeApp(firebaseConfig);db=getFirestore(firebaseApp);auth=getAuth(firebaseApp);console.log('‚úÖ Firebase initialisiert');return true}catch(error){console.error("Firebase Fehler:",error);return false}};
        const INITIAL_MOTORRAEDER=[];
        const INITIAL_FAHRER=[];
        const EINSATZTYPEN=['Pflichtdienst','Optionaler Dienst','Fachfortbildung','Sanit√§tsdienst','Streife','Veranstaltung','Werkstatt'];
        const calculateEinsatzDauer=(zeitVon,zeitBis)=>{if(!zeitVon||!zeitBis)return 0;const[hVon,mVon]=zeitVon.split(':').map(Number);const[hBis,mBis]=zeitBis.split(':').map(Number);let dauer=(hBis*60+mBis)-(hVon*60+mVon);if(dauer<0)dauer+=24*60;return dauer/60};
        const exportEinsatzToCSV=(einsatz,motorraeder,fahrer)=>{const motorraederDetails=einsatz.motorraeder.map(id=>{const m=motorraeder.find(x=>x.id===id);return m?`${m.kennzeichen} (${m.marke} ${m.typ})`:id}).join(', ');const fahrerDetails=einsatz.fahrer.map(id=>{const f=fahrer.find(x=>x.id===id);return f?`${f.vorname} ${f.nachname}`:id}).join(', ');const csv=[['Einsatzplanung - Export'],[],['Datum Von',new Date(einsatz.datumVon||einsatz.datum).toLocaleDateString('de-DE')],['Datum Bis',new Date(einsatz.datumBis||einsatz.datumVon||einsatz.datum).toLocaleDateString('de-DE')],['Uhrzeit',`${einsatz.zeitVon} - ${einsatz.zeitBis}`],['Veranstaltung',einsatz.veranstaltung],['Ort',einsatz.ort],['Typ',einsatz.typ],['Status',einsatz.status||'Geplant'],['Kilometer',einsatz.km||0],['Einsatzstunden',calculateEinsatzDauer(einsatz.zeitVon,einsatz.zeitBis).toFixed(2)],[],['Motorr√§der',motorraederDetails],[],['Fahrer',fahrerDetails],[],['Bemerkungen',einsatz.bemerkungen||'-']].map(row=>row.join(';')).join('\n');const blob=new Blob(['\ufeff'+csv],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=`Einsatz_${einsatz.veranstaltung.replace(/\s+/g,'_')}_${new Date(einsatz.datum).toISOString().split('T')[0]}.csv`;link.click()};
        const exportMultipleEinsaetzeToCSV=(einsaetze,motorraeder,fahrer,zeitraumLabel)=>{const header=['Datum Von','Datum Bis','Uhrzeit Von','Uhrzeit Bis','Veranstaltung','Ort','Typ','Status','Kilometer','Einsatzstunden','Motorr√§der','Fahrer','Bemerkungen'];const rows=einsaetze.map(e=>{const motorraederText=e.motorraeder.map(id=>{const m=motorraeder.find(x=>x.id===id);return m?m.kennzeichen:id}).join(', ');const fahrerText=e.fahrer.map(id=>{const f=fahrer.find(x=>x.id===id);return f?`${f.vorname} ${f.nachname}`:id}).join(', ');return[new Date(e.datumVon||e.datum).toLocaleDateString('de-DE'),new Date(e.datumBis||e.datumVon||e.datum).toLocaleDateString('de-DE'),e.zeitVon,e.zeitBis,e.veranstaltung,e.ort,e.typ,e.status||'Geplant',e.km||0,calculateEinsatzDauer(e.zeitVon,e.zeitBis).toFixed(2),motorraederText,fahrerText,e.bemerkungen||'-']});const csv=[[`Einsatzplanung Export - ${zeitraumLabel}`],[],[`Exportiert am: ${new Date().toLocaleDateString('de-DE')} ${new Date().toLocaleTimeString('de-DE')}`],[`Anzahl Eins√§tze: ${einsaetze.length}`],[],header,...rows].map(row=>row.join(';')).join('\n');const blob=new Blob(['\ufeff'+csv],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=`Einsatzplanung_${zeitraumLabel.replace(/\s+/g,'_')}_${new Date().toISOString().split('T')[0]}.csv`;link.click()};
        
        
        // ===== PDF EXPORT =====
        const exportMultipleEinsaetzeToPDF=(einsaetze,motorraeder,fahrer,zeitraumLabel)=>{const{jsPDF}=window.jspdf;const doc=new jsPDF('l','mm','a4');doc.setFont('helvetica','bold');doc.setFontSize(16);doc.text('JUH Motorradgruppe - Einsatzplanung',15,15);doc.setFontSize(10);doc.setFont('helvetica','normal');doc.text(`Export: ${zeitraumLabel}`,15,22);doc.text(`Exportiert am: ${new Date().toLocaleDateString('de-DE')} ${new Date().toLocaleTimeString('de-DE')}`,15,28);doc.text(`Anzahl Eins√§tze: ${einsaetze.length}`,15,34);const tableData=einsaetze.map(e=>{const motorraederText=e.motorraeder.map(id=>{const m=motorraeder.find(x=>x.id===id);return m?m.kennzeichen:id}).join(', ');const fahrerText=e.fahrer.map(id=>{const f=fahrer.find(x=>x.id===id);return f?`${f.vorname} ${f.nachname}`:id}).join(', ');return[new Date(e.datumVon||e.datum).toLocaleDateString('de-DE'),new Date(e.datumBis||e.datumVon||e.datum).toLocaleDateString('de-DE'),e.zeitVon,e.zeitBis,e.veranstaltung,e.ort,e.typ,e.status||'Geplant',e.km||0,calculateEinsatzDauer(e.zeitVon,e.zeitBis).toFixed(1),motorraederText,fahrerText]});doc.autoTable({startY:40,head:[['Von','Bis','Zeit Von','Zeit Bis','Veranstaltung','Ort','Typ','Status','KM','Std','Motorr√§der','Fahrer']],body:tableData,styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:[227,6,19],textColor:255,fontStyle:'bold'},alternateRowStyles:{fillColor:[245,245,245]},columnStyles:{0:{cellWidth:22},1:{cellWidth:15},2:{cellWidth:15},3:{cellWidth:35},4:{cellWidth:25},5:{cellWidth:25},6:{cellWidth:20},7:{cellWidth:12},8:{cellWidth:12},9:{cellWidth:30},10:{cellWidth:35}}});doc.save(`Einsatzplanung_${zeitraumLabel.replace(/\s+/g,'_')}_${new Date().toISOString().split('T')[0]}.pdf`)};
        
        // ===== XLSX EXPORT =====
        const exportMultipleEinsaetzeToXLSX=(einsaetze,motorraeder,fahrer,zeitraumLabel)=>{const workbook=XLSX.utils.book_new();const header=[['Einsatzplanung Export - '+zeitraumLabel],[],[`Exportiert am: ${new Date().toLocaleDateString('de-DE')} ${new Date().toLocaleTimeString('de-DE')}`],[`Anzahl Eins√§tze: ${einsaetze.length}`],[],['Datum Von','Datum Bis','Uhrzeit Von','Uhrzeit Bis','Veranstaltung','Ort','Typ','Status','Kilometer','Einsatzstunden','Motorr√§der','Fahrer','Bemerkungen']];const rows=einsaetze.map(e=>{const motorraederText=e.motorraeder.map(id=>{const m=motorraeder.find(x=>x.id===id);return m?m.kennzeichen:id}).join(', ');const fahrerText=e.fahrer.map(id=>{const f=fahrer.find(x=>x.id===id);return f?`${f.vorname} ${f.nachname}`:id}).join(', ');return[new Date(e.datumVon||e.datum).toLocaleDateString('de-DE'),new Date(e.datumBis||e.datumVon||e.datum).toLocaleDateString('de-DE'),e.zeitVon,e.zeitBis,e.veranstaltung,e.ort,e.typ,e.status||'Geplant',e.km||0,calculateEinsatzDauer(e.zeitVon,e.zeitBis).toFixed(2),motorraederText,fahrerText,e.bemerkungen||'-']});const allData=[...header,...rows];const worksheet=XLSX.utils.aoa_to_sheet(allData);const colWidths=[{wch:12},{wch:12},{wch:12},{wch:12},{wch:30},{wch:20},{wch:20},{wch:15},{wch:10},{wch:12},{wch:30},{wch:30},{wch:40}];worksheet['!cols']=colWidths;XLSX.utils.book_append_sheet(workbook,worksheet,'Eins√§tze');XLSX.writeFile(workbook,`Einsatzplanung_${zeitraumLabel.replace(/\s+/g,'_')}_${new Date().toISOString().split('T')[0]}.xlsx`)};
        
        const LoginPage=()=>{const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[error,setError]=useState('');const[loading,setLoading]=useState(false);const handleEmailLogin=async(e)=>{e.preventDefault();setError('');setLoading(true);try{const{signInWithEmailAndPassword}=window.firebaseModules;await signInWithEmailAndPassword(auth,email,password)}catch(error){setError('Anmeldung fehlgeschlagen')}setLoading(false)};const handleGoogleLogin=async()=>{setError('');setLoading(true);try{const{signInWithPopup,GoogleAuthProvider}=window.firebaseModules;const provider=new GoogleAuthProvider();await signInWithPopup(auth,provider)}catch(error){setError('Google-Anmeldung fehlgeschlagen')}setLoading(false)};return(<div className="login-container"><div className="login-box"><div className="login-header"><div className="logo-icon">JUH</div><h1>üèçÔ∏è Einsatzplanung</h1><p>Johanniter Unfallhilfe Bayern</p></div><div className="login-body"><h2 style={{marginBottom:'1.5rem',fontSize:'1.3rem'}}>Anmelden</h2>{error&&<div className="error-message">‚ö†Ô∏è {error}</div>}<form onSubmit={handleEmailLogin}><div className="form-group"><label className="form-label">E-Mail</label><input type="email" className="form-input" value={email} onChange={(e)=>setEmail(e.target.value)} required disabled={loading}/></div><div className="form-group"><label className="form-label">Passwort</label><input type="password" className="form-input" value={password} onChange={(e)=>setPassword(e.target.value)} required disabled={loading}/></div><button type="submit" className="btn btn-primary" style={{width:'100%'}} disabled={loading}>{loading?'‚è≥ Wird angemeldet...':'üîê Mit E-Mail anmelden'}</button></form><div className="divider"><span>oder</span></div><button className="btn btn-google" onClick={handleGoogleLogin} disabled={loading}><svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>Mit Google anmelden</button></div></div></div>)};
        
        const EinsatzplanungApp=()=>{const[user,setUser]=useState(null);const[authLoading,setAuthLoading]=useState(true);const[activeTab,setActiveTab]=useState('dashboard');const[dashboardStatus,setDashboardStatus]=useState('Geplant');const[dashboardZeitraum,setDashboardZeitraum]=useState('alle');const[dashboardVon,setDashboardVon]=useState('');const[dashboardBis,setDashboardBis]=useState('');const[einsaetze,setEinsaetze]=useState([]);const[motorraeder,setMotorraeder]=useState(INITIAL_MOTORRAEDER);const[fahrer,setFahrer]=useState(INITIAL_FAHRER);const[searchTerm,setSearchTerm]=useState('');const[filterTyp,setFilterTyp]=useState('');const[filterStatus,setFilterStatus]=useState('');const[loading,setLoading]=useState(true);const[showNewEinsatzModal,setShowNewEinsatzModal]=useState(false);const[showFahrerModal,setShowFahrerModal]=useState(false);const[showMotorradModal,setShowMotorradModal]=useState(false);const[showExportModal,setShowExportModal]=useState(false);const[deleteConfirm,setDeleteConfirm]=useState(null);const[editEinsatz,setEditEinsatz]=useState(null);const[editFahrer,setEditFahrer]=useState(null);const[editMotorrad,setEditMotorrad]=useState(null);const[showKmUpdateModal,setShowKmUpdateModal]=useState(false);const[kmUpdateEinsatz,setKmUpdateEinsatz]=useState(null);const userIsAdmin=user?isAdmin(user.email):false;useEffect(()=>{initFirebase();const{onAuthStateChanged}=window.firebaseModules;const unsubscribe=onAuthStateChanged(auth,(user)=>{setUser(user);setAuthLoading(false);if(user){loadSampleData()}});return()=>unsubscribe()},[]);const loadSampleData=async()=>{try{if(!db){console.log('‚ö†Ô∏è Firestore nicht bereit, starte mit leeren Daten');setLoading(false);return}const{getDocs,collection}=window.firebaseModules;const einsaetzeSnap=await getDocs(collection(db,'einsaetze'));const einsaetzeData=einsaetzeSnap.docs.map(doc=>({id:doc.id,...doc.data()}));setEinsaetze(einsaetzeData);const motorraederSnap=await getDocs(collection(db,'motorraeder'));const motorraederData=motorraederSnap.docs.map(doc=>({id:doc.id,...doc.data()}));if(motorraederData.length>0)setMotorraeder(motorraederData);const fahrerSnap=await getDocs(collection(db,'fahrer'));const fahrerData=fahrerSnap.docs.map(doc=>({id:doc.id,...doc.data()}));if(fahrerData.length>0)setFahrer(fahrerData);console.log('‚úÖ Daten geladen:',einsaetzeData.length,'Eins√§tze');setLoading(false)}catch(error){console.error('Fehler beim Laden:',error);setLoading(false)}};const handleLogout=async()=>{try{const{signOut}=window.firebaseModules;await signOut(auth)}catch(error){console.error('Logout Fehler:',error)}};const toggleEinsatzStatus=(id)=>{if(!userIsAdmin){alert('‚õî Keine Berechtigung! Nur Admins k√∂nnen den Status √§ndern.');return}const einsatz=einsaetze.find(e=>e.id===id);if(!einsatz)return;if(einsatz.status==='Geplant'){setKmUpdateEinsatz(einsatz);setShowKmUpdateModal(true)}else{(async()=>{try{const{updateDoc,doc}=window.firebaseModules;await updateDoc(doc(db,'einsaetze',id),{status:'Geplant'});setEinsaetze(einsaetze.map(e=>{if(e.id===id){return{...e,status:'Geplant'}}return e}));console.log('‚úÖ Status ‚Üí Geplant')}catch(error){console.error('‚ùå Fehler:',error)}})()}};const filteredEinsaetze=einsaetze.filter(e=>{const matchesSearch=searchTerm===''||e.veranstaltung.toLowerCase().includes(searchTerm.toLowerCase())||e.ort.toLowerCase().includes(searchTerm.toLowerCase());const matchesFilter=filterTyp===''||e.typ===filterTyp;const matchesStatus=filterStatus===''||e.status===filterStatus;return matchesSearch&&matchesFilter&&matchesStatus});const stats={gesamt:einsaetze.length,geplant:einsaetze.filter(e=>e.status==='Geplant').length,abgeschlossen:einsaetze.filter(e=>e.status==='Abgeschlossen').length,gesamtKM:einsaetze.reduce((sum,e)=>sum+(e.km||0),0),gesamtStunden:einsaetze.reduce((sum,e)=>sum+calculateEinsatzDauer(e.zeitVon,e.zeitBis),0)};if(authLoading){return(<div style={{display:'flex',justifyContent:'center',alignItems:'center',minHeight:'100vh',fontSize:'1.5rem',color:'var(--text-light)'}}>‚è≥ Wird geladen...</div>)}if(!user){return<LoginPage/>}
        
        return(<div className="container"><header className="header"><div className="header-content"><div className="logo-section"><div className="logo-icon">JUH</div><div className="header-title"><h1>üèçÔ∏è Motorradgruppe Einsatzplanung</h1><span className="subtitle">Johanniter Unfallhilfe - Bayern</span></div></div><div className="header-actions">{userIsAdmin&&<button className="btn-header" onClick={()=>setShowNewEinsatzModal(true)}>‚ûï Neuer Einsatz</button>}<div className="user-info"><span className="user-email">üë§ {user.email}</span>{userIsAdmin&&<span className="admin-badge">üëë Admin</span>}<button className="btn-logout" onClick={handleLogout}>üö™ Abmelden</button></div></div></div></header><nav className="nav-tabs"><button className={`nav-tab ${activeTab==='dashboard'?'active':''}`} onClick={()=>setActiveTab('dashboard')}>üìä Dashboard</button><button className={`nav-tab ${activeTab==='einsaetze'?'active':''}`} onClick={()=>setActiveTab('einsaetze')}>üìÖ Einsatzplanung</button><button className={`nav-tab ${activeTab==='motorraeder'?'active':''}`} onClick={()=>setActiveTab('motorraeder')}>üèçÔ∏è Motorr√§der</button><button className={`nav-tab ${activeTab==='fahrer'?'active':''}`} onClick={()=>setActiveTab('fahrer')}>üë• Fahrer</button><button className={`nav-tab ${activeTab==='statistik'?'active':''}`} onClick={()=>setActiveTab('statistik')}>üìà Statistiken</button></nav><main className="main-content">{activeTab==='dashboard'&&(<div><div className="stats-grid"><div className="stat-card"><div className="stat-value">{stats.gesamt}</div><div className="stat-label">Eins√§tze Gesamt</div></div><div className="stat-card"><div className="stat-value">{stats.geplant}</div><div className="stat-label">Geplante Eins√§tze</div></div><div className="stat-card"><div className="stat-value">{stats.abgeschlossen}</div><div className="stat-label">Abgeschlossen</div></div><div className="stat-card"><div className="stat-value">{stats.gesamtKM.toLocaleString()}</div><div className="stat-label">Kilometer Gesamt</div></div><div className="stat-card"><div className="stat-value">{stats.gesamtStunden.toFixed(1)}</div><div className="stat-label">Einsatzstunden</div></div></div><div className="card"><div className="card-header"><h2 className="card-title">Eins√§tze √úbersicht</h2></div><div className="search-filter-bar"><select className="form-select" value={dashboardStatus} onChange={(e)=>setDashboardStatus(e.target.value)} style={{maxWidth:'200px'}}><option value="Geplant">Nur Geplante</option><option value="Abgeschlossen">Nur Abgeschlossene</option><option value="Alle">Alle Eins√§tze</option></select><select className="form-select" value={dashboardZeitraum} onChange={(e)=>setDashboardZeitraum(e.target.value)} style={{maxWidth:'200px'}}><option value="alle">Alle Zeitr√§ume</option><option value="woche">Diese Woche</option><option value="monat">Dieser Monat</option><option value="jahr">Dieses Jahr</option><option value="custom">Benutzerdefiniert</option></select>{dashboardZeitraum==='custom'&&(<><input type="date" className="form-input" placeholder="Von" value={dashboardVon} onChange={(e)=>setDashboardVon(e.target.value)} style={{maxWidth:'150px',marginLeft:'0.5rem'}}/><input type="date" className="form-input" placeholder="Bis" value={dashboardBis} onChange={(e)=>setDashboardBis(e.target.value)} style={{maxWidth:'150px',marginLeft:'0.5rem'}}/></>)}</div><div className="table-container"><table className="table"><thead><tr><th>Von - Bis</th><th>Veranstaltung</th><th>Ort</th><th>Typ</th><th>Status</th><th>Fahrer</th><th>Dauer</th></tr></thead><tbody>{(()=>{let filtered=einsaetze;if(dashboardStatus!=='Alle'){filtered=filtered.filter(e=>e.status===dashboardStatus)}if(dashboardZeitraum==='woche'){const now=new Date();const weekStart=new Date(now);weekStart.setDate(now.getDate()-now.getDay()+1);const weekEnd=new Date(weekStart);weekEnd.setDate(weekStart.getDate()+6);filtered=filtered.filter(e=>new Date(e.datumVon||e.datum)>=weekStart&&new Date(e.datumVon||e.datum)<=weekEnd)}else if(dashboardZeitraum==='monat'){const now=new Date();const monthStart=new Date(now.getFullYear(),now.getMonth(),1);const monthEnd=new Date(now.getFullYear(),now.getMonth()+1,0);filtered=filtered.filter(e=>new Date(e.datumVon||e.datum)>=monthStart&&new Date(e.datumVon||e.datum)<=monthEnd)}else if(dashboardZeitraum==='jahr'){const now=new Date();const yearStart=new Date(now.getFullYear(),0,1);const yearEnd=new Date(now.getFullYear(),11,31);filtered=filtered.filter(e=>new Date(e.datumVon||e.datum)>=yearStart&&new Date(e.datumVon||e.datum)<=yearEnd)}else if(dashboardZeitraum==='custom'&&dashboardVon&&dashboardBis){const vonDate=new Date(dashboardVon);const bisDate=new Date(dashboardBis);filtered=filtered.filter(e=>{const d=new Date(e.datumVon||e.datum);return d>=vonDate&&d<=bisDate})}return filtered.map(einsatz=>(<tr key={einsatz.id}><td>{new Date(einsatz.datumVon||einsatz.datum).toLocaleDateString('de-DE')}{(einsatz.datumBis&&einsatz.datumBis!==einsatz.datumVon)?' - '+new Date(einsatz.datumBis).toLocaleDateString('de-DE'):''}</td><td><strong>{einsatz.veranstaltung}</strong></td><td>{einsatz.ort}</td><td><span className={`badge ${einsatz.typ==='Pflichtdienst'?'badge-pflicht':einsatz.typ==='Optionaler Dienst'?'badge-optional':'badge-info'}`}>{einsatz.typ}</span></td><td><span className={`badge ${einsatz.status==='Geplant'?'badge-geplant':'badge-abgeschlossen'}`}>{einsatz.status}</span></td><td>{einsatz.fahrer.map(id=>{const f=fahrer.find(x=>x.id===id);return f?`${f.vorname} ${f.nachname}`:id}).join(', ')}</td><td>{calculateEinsatzDauer(einsatz.zeitVon,einsatz.zeitBis).toFixed(1)}h</td></tr>))})()}</tbody></table></div></div></div>)}{activeTab==='einsaetze'&&(<div className="card"><div className="card-header"><h2 className="card-title">Alle Eins√§tze</h2><div className="card-actions"><button className="btn btn-success" onClick={()=>setShowExportModal(true)}>üìä Gesamtexport</button>{userIsAdmin&&<button className="btn btn-primary" onClick={()=>setShowNewEinsatzModal(true)}>‚ûï Neuer Einsatz</button>}</div></div><div className="search-filter-bar"><input type="text" className="search-input" placeholder="üîç Suche nach Veranstaltung oder Ort..." value={searchTerm} onChange={(e)=>setSearchTerm(e.target.value)}/><select className="form-select" value={filterTyp} onChange={(e)=>setFilterTyp(e.target.value)} style={{maxWidth:'200px'}}><option value="">Alle Typen</option>{EINSATZTYPEN.map(typ=>(<option key={typ} value={typ}>{typ}</option>))}</select><select className="form-select" value={filterStatus} onChange={(e)=>setFilterStatus(e.target.value)} style={{maxWidth:'200px'}}><option value="">Alle Status</option><option value="Geplant">Geplant</option><option value="Abgeschlossen">Abgeschlossen</option></select></div><div className="table-container"><table className="table"><thead><tr><th>Von - Bis</th><th>Veranstaltung</th><th>Ort</th><th>Typ</th><th>Status</th><th>Motorr√§der</th><th>Fahrer</th><th>KM</th><th>Std</th>{userIsAdmin&&<th>Aktionen</th>}</tr></thead><tbody>{filteredEinsaetze.map(einsatz=>(<tr key={einsatz.id}><td>{new Date(einsatz.datumVon||einsatz.datum).toLocaleDateString('de-DE')}{(einsatz.datumBis&&einsatz.datumBis!==einsatz.datumVon)?' - '+new Date(einsatz.datumBis).toLocaleDateString('de-DE'):''}</td><td><strong>{einsatz.veranstaltung}</strong></td><td>{einsatz.ort}</td><td><span className={`badge ${einsatz.typ==='Pflichtdienst'?'badge-pflicht':einsatz.typ==='Optionaler Dienst'?'badge-optional':'badge-info'}`}>{einsatz.typ}</span></td><td><span className={`badge ${einsatz.status==='Geplant'?'badge-geplant':'badge-abgeschlossen'}`}>{einsatz.status}</span></td><td>{einsatz.motorraeder.map(id=>{const m=motorraeder.find(x=>x.id===id);return m?m.kennzeichen:id}).join(', ')}</td><td>{einsatz.fahrer.map(id=>{const f=fahrer.find(x=>x.id===id);return f?`${f.vorname} ${f.nachname}`:id}).join(', ')}</td><td>{einsatz.km||0}</td><td>{calculateEinsatzDauer(einsatz.zeitVon,einsatz.zeitBis).toFixed(1)}h</td>{userIsAdmin&&<td><button className="action-btn action-btn-complete" onClick={()=>toggleEinsatzStatus(einsatz.id)} title={einsatz.status==='Geplant'?'Als abgeschlossen markieren':'Als geplant markieren'}>{einsatz.status==='Geplant'?'‚úì':'‚Ü∫'}</button><button className="action-btn action-btn-edit" onClick={()=>exportEinsatzToCSV(einsatz,motorraeder,fahrer)} title="Als CSV exportieren">üíæ</button><button className="action-btn action-btn-edit" onClick={()=>{setEditEinsatz(einsatz);setShowNewEinsatzModal(true)}} title="Einsatz bearbeiten">‚úèÔ∏è</button><button className="action-btn action-btn-delete" onClick={()=>setDeleteConfirm(einsatz.id)} title="Einsatz l√∂schen">üóëÔ∏è</button></td>}</tr>))}</tbody></table></div></div>)}{activeTab==='motorraeder'&&(<div className="card"><div className="card-header"><h2 className="card-title">Motorr√§der Verwaltung</h2>{userIsAdmin&&<button className="btn btn-primary" onClick={()=>setShowMotorradModal(true)}>‚ûï Neues Motorrad</button>}</div><div className="table-container"><table className="table"><thead><tr><th>Kennzeichen</th><th>Marke</th><th>Typ</th><th>Baujahr</th><th>KM-Stand</th><th>Eins√§tze</th>{userIsAdmin&&<th>Aktionen</th>}</tr></thead><tbody>{motorraeder.map(motorrad=>{const count=einsaetze.filter(e=>e.motorraeder.includes(motorrad.id)).length;return(<tr key={motorrad.id}><td><strong>{motorrad.kennzeichen}</strong></td><td>{motorrad.marke}</td><td>{motorrad.typ}</td><td>{motorrad.baujahr}</td><td>{motorrad.kilometerstand.toLocaleString()} km</td><td>{count}</td>{userIsAdmin&&<td><button className="action-btn action-btn-edit" onClick={()=>{setEditMotorrad(motorrad);setShowMotorradModal(true)}} title="Motorrad bearbeiten">‚úèÔ∏è</button><button className="action-btn action-btn-delete" onClick={()=>{if(window.confirm('Motorrad '+motorrad.kennzeichen+' wirklich l√∂schen?')){setMotorraeder(motorraeder.filter(m=>m.id!==motorrad.id))}}} title="Motorrad l√∂schen">üóëÔ∏è</button></td>}</tr>)})}</tbody></table></div></div>)}{activeTab==='fahrer'&&(<div className="card"><div className="card-header"><h2 className="card-title">Fahrer Verwaltung</h2>{userIsAdmin&&<button className="btn btn-primary" onClick={()=>setShowFahrerModal(true)}>‚ûï Neuer Fahrer</button>}</div><div className="table-container"><table className="table"><thead><tr><th>Name</th><th>E-Mail 1</th><th>E-Mail 2</th><th>Telefon 1</th><th>Telefon 2</th><th>Geburtstag</th><th>Eins√§tze</th>{userIsAdmin&&<th>Aktionen</th>}</tr></thead><tbody>{fahrer.sort((a,b)=>a.nachname.localeCompare(b.nachname)).map(f=>{const count=einsaetze.filter(e=>e.fahrer.includes(f.id)).length;return(<tr key={f.id}><td><strong>{f.vorname} {f.nachname}</strong></td><td>{f.email||'-'}</td><td>{f.email2||'-'}</td><td>{f.telefon||'-'}</td><td>{f.telefon2||'-'}</td><td>{f.geburtstag?new Date(f.geburtstag).toLocaleDateString('de-DE'):'-'}</td><td>{count}</td>{userIsAdmin&&<td><button className="action-btn action-btn-edit" onClick={()=>{setEditFahrer(f);setShowFahrerModal(true)}} title="Fahrer bearbeiten">‚úèÔ∏è</button><button className="action-btn action-btn-delete" onClick={()=>{if(window.confirm('Fahrer '+f.vorname+' '+f.nachname+' wirklich l√∂schen?')){setFahrer(fahrer.filter(x=>x.id!==f.id))}}} title="Fahrer l√∂schen">üóëÔ∏è</button></td>}</tr>)})}</tbody></table></div></div>)}{activeTab==='statistik'&&(<div><h2 style={{fontSize:'1.8rem',marginBottom:'2rem',color:'var(--juh-red)'}}>üìà Detaillierte Statistiken</h2><div className="card"><div className="card-header"><h2 className="card-title">üèçÔ∏è Motorrad-Statistiken</h2></div><div className="table-container"><table className="table"><thead><tr><th>Motorrad</th><th>Geplant</th><th>Abgeschlossen</th><th>Gesamt</th><th>Gefahrene KM</th><th>Einsatzstunden</th></tr></thead><tbody>{motorraeder.map(motorrad=>{const motorradEinsaetze=einsaetze.filter(e=>e.motorraeder.includes(motorrad.id));const geplant=motorradEinsaetze.filter(e=>e.status==='Geplant').length;const abgeschlossen=motorradEinsaetze.filter(e=>e.status==='Abgeschlossen').length;const km=motorradEinsaetze.reduce((sum,e)=>sum+(e.km||0),0);const stunden=motorradEinsaetze.reduce((sum,e)=>sum+calculateEinsatzDauer(e.zeitVon,e.zeitBis),0);return(<tr key={motorrad.id}><td><strong>{motorrad.kennzeichen}</strong><br/><small style={{color:'var(--text-light)'}}>{motorrad.marke} {motorrad.typ}</small></td><td>{geplant}</td><td>{abgeschlossen}</td><td><strong>{motorradEinsaetze.length}</strong></td><td>{km.toLocaleString()} km</td><td>{stunden.toFixed(1)} h</td></tr>)})}</tbody></table></div></div><div className="card"><div className="card-header"><h2 className="card-title">üë• Fahrer-Statistiken</h2></div><div className="table-container"><table className="table"><thead><tr><th>Fahrer</th><th>Geplant</th><th>Abgeschlossen</th><th>Gesamt</th><th>Einsatzstunden</th></tr></thead><tbody>{fahrer.sort((a,b)=>a.nachname.localeCompare(b.nachname)).map(f=>{const fahrerEinsaetze=einsaetze.filter(e=>e.fahrer.includes(f.id));const geplant=fahrerEinsaetze.filter(e=>e.status==='Geplant').length;const abgeschlossen=fahrerEinsaetze.filter(e=>e.status==='Abgeschlossen').length;const stunden=fahrerEinsaetze.reduce((sum,e)=>sum+calculateEinsatzDauer(e.zeitVon,e.zeitBis),0);return{...f,geplant,abgeschlossen,gesamt:fahrerEinsaetze.length,stunden}}).sort((a,b)=>b.gesamt-a.gesamt).map(f=>(<tr key={f.id}><td><strong>{f.vorname} {f.nachname}</strong></td><td>{f.geplant}</td><td>{f.abgeschlossen}</td><td><strong>{f.gesamt}</strong></td><td>{f.stunden.toFixed(1)} h</td></tr>))}</tbody></table></div></div></div>)}</main>
        
        {showNewEinsatzModal&&(<div className="modal-overlay" onClick={()=>{setShowNewEinsatzModal(false);setEditEinsatz(null)}}><div className="modal" onClick={(e)=>e.stopPropagation()}><div className="modal-header"><h2 className="modal-title">{editEinsatz?'‚úèÔ∏è Einsatz bearbeiten':'‚ûï Neuer Einsatz'}</h2><button className="modal-close" onClick={()=>setShowNewEinsatzModal(false)}>‚úï</button></div><form key={editEinsatz?.id||"new"} onSubmit={(e)=>{e.preventDefault();const formData=new FormData(e.target);const selectedMotorraeder=Array.from(formData.getAll('motorraeder'));const selectedFahrer=Array.from(formData.getAll('fahrer'));if(selectedMotorraeder.length===0){alert('Bitte mindestens ein Motorrad ausw√§hlen!');return}if(selectedFahrer.length===0){alert('Bitte mindestens einen Fahrer ausw√§hlen!');return}const datumVon=formData.get('datumVon');const datumBis=formData.get('datumBis');if(new Date(datumVon)>new Date(datumBis)){alert('Datum Von muss vor oder gleich Datum Bis sein!');return}const neuerEinsatz={datumVon:datumVon,datumBis:datumBis,datum:datumVon,zeitVon:formData.get('zeitVon'),zeitBis:formData.get('zeitBis'),veranstaltung:formData.get('veranstaltung'),ort:formData.get('ort'),typ:formData.get('typ'),motorraeder:selectedMotorraeder,fahrer:selectedFahrer,km:parseInt(formData.get('km'))||0,status:'Geplant',bemerkungen:formData.get('bemerkungen')};(async()=>{try{const{addDoc,updateDoc,collection,doc}=window.firebaseModules;if(editEinsatz){await updateDoc(doc(db,'einsaetze',editEinsatz.id),neuerEinsatz);setEinsaetze(einsaetze.map(e=>e.id===editEinsatz.id?{...neuerEinsatz,id:editEinsatz.id}:e));console.log('‚úÖ Einsatz aktualisiert')}else{const docRef=await addDoc(collection(db,'einsaetze'),neuerEinsatz);setEinsaetze([...einsaetze,{...neuerEinsatz,id:docRef.id}]);console.log('‚úÖ Einsatz erstellt:',docRef.id)}setShowNewEinsatzModal(false);setEditEinsatz(null);e.target.reset()}catch(error){console.error('‚ùå Fehler:',error);alert('Fehler beim Speichern: '+error.message)}})()}}><div className="modal-body"><div className="form-grid"><div className="form-group"><label className="form-label required">Datum Von</label><input type="date" name="datumVon" className="form-input" required defaultValue={editEinsatz?.datumVon||editEinsatz?.datum||""}/></div><div className="form-group"><label className="form-label required">Uhrzeit Von</label><input type="time" name="zeitVon" className="form-input" required defaultValue={editEinsatz?.zeitVon||""}/></div><div className="form-group"><label className="form-label required">Datum Bis</label><input type="date" name="datumBis" className="form-input" required defaultValue={editEinsatz?.datumBis||editEinsatz?.datum||""}/></div><div className="form-group"><label className="form-label required">Uhrzeit Bis</label><input type="time" name="zeitBis" className="form-input" required defaultValue={editEinsatz?.zeitBis||""}/></div><div className="form-group"><label className="form-label">Kilometer</label><input type="number" name="km" className="form-input" min="0" defaultValue={editEinsatz?.km||0}/></div></div><div className="form-group"><label className="form-label required">Veranstaltung</label><input type="text" name="veranstaltung" className="form-input" placeholder="Name der Veranstaltung" required defaultValue={editEinsatz?.veranstaltung||""}/></div><div className="form-grid"><div className="form-group"><label className="form-label required">Ort</label><input type="text" name="ort" className="form-input" placeholder="Veranstaltungsort" required defaultValue={editEinsatz?.ort||""}/></div><div className="form-group"><label className="form-label required">Typ</label><select name="typ" className="form-select" required defaultValue={editEinsatz?.typ||""}><option value="">Bitte w√§hlen...</option>{EINSATZTYPEN.map(typ=>(<option key={typ} value={typ}>{typ}</option>))}</select></div></div><div className="form-group"><label className="form-label required">Motorr√§der ausw√§hlen</label><div className="checkbox-group">{motorraeder.map(m=>(<div key={m.id} className="checkbox-item"><input type="checkbox" name="motorraeder" value={m.id} id={`motorrad-${m.id}`} defaultChecked={editEinsatz?.motorraeder?.includes(m.id)}/><label htmlFor={`motorrad-${m.id}`}>{m.kennzeichen}</label></div>))}</div></div><div className="form-group"><label className="form-label required">Fahrer ausw√§hlen</label><div className="checkbox-group">{fahrer.sort((a,b)=>a.nachname.localeCompare(b.nachname)).map(f=>(<div key={f.id} className="checkbox-item"><input type="checkbox" name="fahrer" value={f.id} id={`fahrer-${f.id}`} defaultChecked={editEinsatz?.fahrer?.includes(f.id)}/><label htmlFor={`fahrer-${f.id}`}>{f.vorname} {f.nachname}</label></div>))}</div></div><div className="form-group"><label className="form-label">Bemerkungen</label><textarea name="bemerkungen" className="form-textarea" placeholder="Optional: Zus√§tzliche Informationen..." defaultValue={editEinsatz?.bemerkungen||""}/></div></div><div className="modal-footer"><button type="button" className="btn btn-secondary" onClick={()=>setShowNewEinsatzModal(false)}>Abbrechen</button><button type="submit" className="btn btn-primary">üíæ Speichern</button></div></form></div></div>)}
        
        {showExportModal&&(<div className="modal-overlay" onClick={()=>setShowExportModal(false)}><div className="modal" onClick={(e)=>e.stopPropagation()}><div className="modal-header"><h2 className="modal-title">üìä Gesamtexport</h2><button className="modal-close" onClick={()=>setShowExportModal(false)}>‚úï</button></div><div className="modal-body"><p style={{marginBottom:'1.5rem',color:'var(--text-light)'}}>W√§hlen Sie Format, Zeitraum und Status f√ºr den Export:</p><div className="form-group"><label className="form-label">Export-Format</label><select id="exportFormat" className="form-select" defaultValue="CSV"><option value="CSV">üìÑ CSV (Excel kompatibel)</option><option value="XLSX">üìä XLSX (Excel Datei)</option><option value="PDF">üìï PDF (Druckversion)</option></select></div><div className="form-group"><label className="form-label">Status-Filter</label><select id="exportStatus" className="form-select" defaultValue="Geplant"><option value="Geplant">Nur Geplante Eins√§tze</option><option value="Abgeschlossen">Nur Abgeschlossene Eins√§tze</option><option value="Alle">Alle Eins√§tze</option></select></div><h3 style={{marginTop:'1.5rem',marginBottom:'1rem',fontSize:'1.1rem',fontWeight:600}}>Schnellauswahl:</h3><div className="export-options"><button className="btn btn-primary" onClick={()=>{const status=document.getElementById('exportStatus').value;const now=new Date();const weekStart=new Date(now);weekStart.setDate(now.getDate()-now.getDay()+1);const weekEnd=new Date(weekStart);weekEnd.setDate(weekStart.getDate()+6);let filtered=einsaetze.filter(e=>new Date(e.datumVon||e.datum)>=weekStart&&new Date(e.datumVon||e.datum)<=weekEnd);if(status!=='Alle')filtered=filtered.filter(e=>e.status===status);const format=document.getElementById('exportFormat').value;const label=`Diese Woche (${status})`;if(format==='PDF'){exportMultipleEinsaetzeToPDF(filtered,motorraeder,fahrer,label)}else if(format==='XLSX'){exportMultipleEinsaetzeToXLSX(filtered,motorraeder,fahrer,label)}else{exportMultipleEinsaetzeToCSV(filtered,motorraeder,fahrer,label)}setShowExportModal(false)}}>üìÖ Diese Woche</button><button className="btn btn-primary" onClick={()=>{const status=document.getElementById('exportStatus').value;const now=new Date();const monthStart=new Date(now.getFullYear(),now.getMonth(),1);const monthEnd=new Date(now.getFullYear(),now.getMonth()+1,0);let filtered=einsaetze.filter(e=>new Date(e.datumVon||e.datum)>=monthStart&&new Date(e.datumVon||e.datum)<=monthEnd);if(status!=='Alle')filtered=filtered.filter(e=>e.status===status);const format=document.getElementById('exportFormat').value;const label=`Dieser Monat (${status})`;if(format==='PDF'){exportMultipleEinsaetzeToPDF(filtered,motorraeder,fahrer,label)}else if(format==='XLSX'){exportMultipleEinsaetzeToXLSX(filtered,motorraeder,fahrer,label)}else{exportMultipleEinsaetzeToCSV(filtered,motorraeder,fahrer,label)}setShowExportModal(false)}}>üìÖ Dieser Monat</button><button className="btn btn-primary" onClick={()=>{const status=document.getElementById('exportStatus').value;const now=new Date();const yearStart=new Date(now.getFullYear(),0,1);const yearEnd=new Date(now.getFullYear(),11,31);let filtered=einsaetze.filter(e=>new Date(e.datumVon||e.datum)>=yearStart&&new Date(e.datumVon||e.datum)<=yearEnd);if(status!=='Alle')filtered=filtered.filter(e=>e.status===status);const format=document.getElementById('exportFormat').value;const label=`Dieses Jahr 2025 (${status})`;if(format==='PDF'){exportMultipleEinsaetzeToPDF(filtered,motorraeder,fahrer,label)}else if(format==='XLSX'){exportMultipleEinsaetzeToXLSX(filtered,motorraeder,fahrer,label)}else{exportMultipleEinsaetzeToCSV(filtered,motorraeder,fahrer,label)}setShowExportModal(false)}}>üìÖ Dieses Jahr</button><button className="btn btn-primary" onClick={()=>{const status=document.getElementById('exportStatus').value;let filtered=status==='Alle'?einsaetze:einsaetze.filter(e=>e.status===status);const format=document.getElementById('exportFormat').value;const label=`Alle Eins√§tze (${status})`;if(format==='PDF'){exportMultipleEinsaetzeToPDF(filtered,motorraeder,fahrer,label)}else if(format==='XLSX'){exportMultipleEinsaetzeToXLSX(filtered,motorraeder,fahrer,label)}else{exportMultipleEinsaetzeToCSV(filtered,motorraeder,fahrer,label)}setShowExportModal(false)}}>üìÖ Alle Eins√§tze</button></div><h3 style={{marginTop:'1.5rem',marginBottom:'1rem',fontSize:'1.1rem',fontWeight:600}}>Benutzerdefinierter Zeitraum:</h3><div className="form-grid"><div className="form-group"><label className="form-label">Von Datum</label><input type="date" id="exportVon" className="form-input"/></div><div className="form-group"><label className="form-label">Bis Datum</label><input type="date" id="exportBis" className="form-input"/></div></div><button className="btn btn-success" style={{width:'100%',marginTop:'1rem'}} onClick={()=>{const status=document.getElementById('exportStatus').value;const von=document.getElementById('exportVon').value;const bis=document.getElementById('exportBis').value;if(!von||!bis){alert('Bitte beide Datumsfelder ausf√ºllen!');return}const vonDate=new Date(von);const bisDate=new Date(bis);if(vonDate>bisDate){alert('Von-Datum muss vor Bis-Datum liegen!');return}let filtered=einsaetze.filter(e=>{const d=new Date(e.datumVon||e.datum);return d>=vonDate&&d<=bisDate});if(status!=='Alle')filtered=filtered.filter(e=>e.status===status);const label=`${vonDate.toLocaleDateString('de-DE')} - ${bisDate.toLocaleDateString('de-DE')} (${status})`;const format=document.getElementById('exportFormat').value;if(format==='PDF'){exportMultipleEinsaetzeToPDF(filtered,motorraeder,fahrer,label)}else if(format==='XLSX'){exportMultipleEinsaetzeToXLSX(filtered,motorraeder,fahrer,label)}else{exportMultipleEinsaetzeToCSV(filtered,motorraeder,fahrer,label)}setShowExportModal(false)}}>üìä Zeitraum exportieren</button><div className="info-box"><strong>üí° Hinweis:</strong> Der Export enth√§lt alle Details inklusive Motorr√§der, Fahrer, Kilometer und Einsatzstunden.</div></div><div className="modal-footer"><button className="btn btn-secondary" onClick={()=>setShowExportModal(false)}>Schlie√üen</button></div></div></div>)}
        
        {deleteConfirm&&(<div className="modal-overlay" onClick={()=>setDeleteConfirm(null)}><div className="modal confirm-dialog" onClick={(e)=>e.stopPropagation()}><div className="modal-header"><h2 className="modal-title">‚ö†Ô∏è Einsatz l√∂schen?</h2><button className="modal-close" onClick={()=>setDeleteConfirm(null)}>‚úï</button></div><div className="confirm-message">M√∂chten Sie diesen Einsatz wirklich l√∂schen?<br/><strong>Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.</strong></div><div className="modal-footer"><button className="btn btn-secondary" onClick={()=>setDeleteConfirm(null)}>Abbrechen</button><button className="btn btn-danger" onClick={async()=>{try{const{deleteDoc,doc}=window.firebaseModules;await deleteDoc(doc(db,'einsaetze',deleteConfirm));setEinsaetze(einsaetze.filter(e=>e.id!==deleteConfirm));setDeleteConfirm(null);console.log('‚úÖ Einsatz gel√∂scht')}catch(error){console.error('‚ùå Fehler:',error);alert('Fehler beim L√∂schen: '+error.message)}}}>üóëÔ∏è Endg√ºltig l√∂schen</button></div></div></div>)}
        
        {showFahrerModal&&(<div className="modal-overlay" onClick={()=>{setShowFahrerModal(false);setEditFahrer(null)}}><div className="modal" onClick={(e)=>e.stopPropagation()}><div className="modal-header"><h2 className="modal-title">{editFahrer?'‚úèÔ∏è Fahrer bearbeiten':'‚ûï Neuer Fahrer'}</h2><button className="modal-close" onClick={()=>{setShowFahrerModal(false);setEditFahrer(null)}}>‚úï</button></div><form onSubmit={(e)=>{e.preventDefault();const formData=new FormData(e.target);const neuerFahrer={id:editFahrer?editFahrer.id:Date.now().toString(),vorname:formData.get('vorname'),nachname:formData.get('nachname'),email:formData.get('email')||'',email2:formData.get('email2')||'',telefon:formData.get('telefon')||'',telefon2:formData.get('telefon2')||'',geburtstag:formData.get('geburtstag')||''};if(editFahrer){setFahrer(fahrer.map(f=>f.id===editFahrer.id?neuerFahrer:f))}else{setFahrer([...fahrer,neuerFahrer])}setShowFahrerModal(false);setEditFahrer(null);e.target.reset()}}><div className="modal-body"><div className="form-grid"><div className="form-group"><label className="form-label required">Vorname</label><input type="text" name="vorname" className="form-input" required defaultValue={editFahrer?.vorname||''}/></div><div className="form-group"><label className="form-label required">Nachname</label><input type="text" name="nachname" className="form-input" required defaultValue={editFahrer?.nachname||''}/></div></div><div className="form-grid"><div className="form-group"><label className="form-label">E-Mail 1</label><input type="email" name="email" className="form-input" placeholder="erste@email.de" defaultValue={editFahrer?.email||''}/></div><div className="form-group"><label className="form-label">E-Mail 2</label><input type="email" name="email2" className="form-input" placeholder="zweite@email.de" defaultValue={editFahrer?.email2||''}/></div><div className="form-group"><label className="form-label">Telefon 1</label><input type="tel" name="telefon" className="form-input" placeholder="+49 151 12345678" defaultValue={editFahrer?.telefon||''}/></div><div className="form-group"><label className="form-label">Telefon 2</label><input type="tel" name="telefon2" className="form-input" placeholder="+49 151 87654321" defaultValue={editFahrer?.telefon2||''}/></div><div className="form-group"><label className="form-label">Geburtstag</label><input type="date" name="geburtstag" className="form-input" defaultValue={editFahrer?.geburtstag||''}/></div></div></div><div className="modal-footer"><button type="button" className="btn btn-secondary" onClick={()=>{setShowFahrerModal(false);setEditFahrer(null)}}>Abbrechen</button><button type="submit" className="btn btn-primary">üíæ Speichern</button></div></form></div></div>)}
        
        {showMotorradModal&&(<div className="modal-overlay" onClick={()=>{setShowMotorradModal(false);setEditMotorrad(null)}}><div className="modal" onClick={(e)=>e.stopPropagation()}><div className="modal-header"><h2 className="modal-title">{editMotorrad?'‚úèÔ∏è Motorrad bearbeiten':'‚ûï Neues Motorrad'}</h2><button className="modal-close" onClick={()=>{setShowMotorradModal(false);setEditMotorrad(null)}}>‚úï</button></div><form key={editMotorrad?.id||"new"} key={editFahrer?.id||"new"} onSubmit={(e)=>{e.preventDefault();const formData=new FormData(e.target);const neuesMotorrad={id:editMotorrad?editMotorrad.id:Date.now().toString(),kennzeichen:formData.get('kennzeichen'),marke:formData.get('marke'),typ:formData.get('typ'),baujahr:parseInt(formData.get('baujahr')),kilometerstand:parseInt(formData.get('kilometerstand'))};if(editMotorrad){setMotorraeder(motorraeder.map(m=>m.id===editMotorrad.id?neuesMotorrad:m))}else{setMotorraeder([...motorraeder,neuesMotorrad])}setShowMotorradModal(false);setEditMotorrad(null);e.target.reset()}}><div className="modal-body"><div className="form-grid"><div className="form-group"><label className="form-label required">Kennzeichen</label><input type="text" name="kennzeichen" className="form-input" placeholder="M-JU 907" required defaultValue={editMotorrad?.kennzeichen||''}/></div><div className="form-group"><label className="form-label required">Marke</label><input type="text" name="marke" className="form-input" placeholder="BMW" required defaultValue={editMotorrad?.marke||''}/></div></div><div className="form-grid"><div className="form-group"><label className="form-label required">Typ</label><input type="text" name="typ" className="form-input" placeholder="R 1200 RT" required defaultValue={editMotorrad?.typ||''}/></div><div className="form-group"><label className="form-label required">Baujahr</label><input type="number" name="baujahr" className="form-input" min="1990" max="2030" required defaultValue={editMotorrad?.baujahr||new Date().getFullYear()}/></div><div className="form-group"><label className="form-label required">Kilometerstand</label><input type="number" name="kilometerstand" className="form-input" min="0" required defaultValue={editMotorrad?.kilometerstand||0}/></div></div></div><div className="modal-footer"><button type="button" className="btn btn-secondary" onClick={()=>{setShowMotorradModal(false);setEditMotorrad(null)}}>Abbrechen</button><button type="submit" className="btn btn-primary">üíæ Speichern</button></div></form></div></div>)}
        
        
        {showKmUpdateModal&&kmUpdateEinsatz&&(<div className="modal-overlay" onClick={()=>{setShowKmUpdateModal(false);setKmUpdateEinsatz(null)}}><div className="modal" onClick={(e)=>e.stopPropagation()}><div className="modal-header"><h2 className="modal-title">üèçÔ∏è Einsatz abschlie√üen</h2><button className="modal-close" onClick={()=>{setShowKmUpdateModal(false);setKmUpdateEinsatz(null)}}>‚úï</button></div><form onSubmit={(e)=>{e.preventDefault();const formData=new FormData(e.target);let hasError=false;const updates=kmUpdateEinsatz.motorraeder.map(mId=>{const m=motorraeder.find(x=>x.id===mId);if(!m)return null;const neuerKm=parseInt(formData.get(`km_${mId}`));if(isNaN(neuerKm)||neuerKm<m.kilometerstand){alert(`Fehler bei ${m.kennzeichen}: Neuer KM-Stand (${neuerKm}) muss >= aktuell (${m.kilometerstand}) sein!`);hasError=true;return null}return{id:mId,neuerKm}}).filter(x=>x!==null);if(hasError)return;(async()=>{try{const{updateDoc,doc}=window.firebaseModules;for(const update of updates){await updateDoc(doc(db,'motorraeder',update.id),{kilometerstand:update.neuerKm})}await updateDoc(doc(db,'einsaetze',kmUpdateEinsatz.id),{status:'Abgeschlossen'});setMotorraeder(motorraeder.map(m=>{const update=updates.find(u=>u.id===m.id);return update?{...m,kilometerstand:update.neuerKm}:m}));setEinsaetze(einsaetze.map(e=>e.id===kmUpdateEinsatz.id?{...e,status:'Abgeschlossen'}:e));console.log('‚úÖ KM-St√§nde & Status aktualisiert')}catch(error){console.error('‚ùå Fehler:',error);alert('Fehler: '+error.message);return}})()setShowKmUpdateModal(false);setKmUpdateEinsatz(null);alert('‚úÖ Einsatz abgeschlossen & Kilometerst√§nde aktualisiert!')}}><div className="modal-body"><p style={{marginBottom:'1.5rem',color:'var(--text-light)'}}>Bitte geben Sie die neuen Kilometerst√§nde nach dem Einsatz ein:</p><div className="info-box" style={{marginBottom:'1.5rem'}}><strong>üìã Einsatz:</strong> {kmUpdateEinsatz.veranstaltung}<br/><strong>üìÖ Von:</strong> {new Date(kmUpdateEinsatz.datumVon||kmUpdateEinsatz.datum).toLocaleDateString('de-DE')} {kmUpdateEinsatz.zeitVon}<br/><strong>üìÖ Bis:</strong> {new Date(kmUpdateEinsatz.datumBis||kmUpdateEinsatz.datumVon||kmUpdateEinsatz.datum).toLocaleDateString('de-DE')} {kmUpdateEinsatz.zeitBis}<br/><strong>üõ£Ô∏è Gefahrene KM:</strong> {kmUpdateEinsatz.km||0} km</div>{kmUpdateEinsatz.motorraeder.map(mId=>{const m=motorraeder.find(x=>x.id===mId);if(!m)return null;const gefahren=kmUpdateEinsatz.km||0;const vorgeschlagen=m.kilometerstand+gefahren;return(<div key={m.id} className="form-group"><label className="form-label required">{m.kennzeichen} - {m.marke} {m.typ}</label><div style={{display:'flex',alignItems:'center',gap:'1rem'}}><div style={{flex:1}}><small style={{color:'var(--text-light)',display:'block',marginBottom:'.25rem'}}>Aktuell: {m.kilometerstand.toLocaleString()} km</small><input type="number" name={`km_${m.id}`} className="form-input" placeholder="Neuer Kilometerstand" defaultValue={vorgeschlagen} min={m.kilometerstand} required/></div><div style={{color:'var(--text-light)',fontSize:'.9rem'}}>+{gefahren} km</div></div></div>)})}
<div className="info-box" style={{background:'#FFF3CD',borderColor:'#FFC107',marginTop:'1.5rem'}}><strong>‚ö†Ô∏è Wichtig:</strong> Die Kilometerst√§nde werden automatisch aktualisiert und k√∂nnen sp√§ter nicht r√ºckg√§ngig gemacht werden.</div></div><div className="modal-footer"><button type="button" className="btn btn-secondary" onClick={()=>{setShowKmUpdateModal(false);setKmUpdateEinsatz(null)}}>Abbrechen</button><button type="submit" className="btn btn-success">‚úÖ Einsatz abschlie√üen</button></div></form></div></div>)}
        
        </div>)};
        
        ReactDOM.render(<EinsatzplanungApp/>,document.getElementById('root'));
        console.log('‚úÖ App gerendert - Version 3.0 KOMPLETT');
    </script>
</body>
</html>
