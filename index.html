<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JUH Motorradgruppe - Einsatzplanung 2025 v4.1 COMPLETE</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        window.firebaseModules = { initializeApp, getAuth, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where, orderBy };
        console.log('âœ… Firebase Module geladen');
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700;800&family=Roboto+Condensed:wght@400;700&display=swap');
        :root{--juh-red:#E30613;--juh-dark-red:#B30510;--juh-light-red:#FF1F2D;--juh-gray:#4A4A4A;--juh-light-gray:#F5F5F5;--juh-border:#E0E0E0;--text-dark:#2C2C2C;--text-light:#666;--success:#28A745;--warning:#FFC107;--info:#17A2B8;--admin-gold:#FFD700}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Barlow',sans-serif;background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%);color:var(--text-dark);min-height:100vh}
        .login-container{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem}
        .login-box{background:#fff;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.15);max-width:450px;width:100%;overflow:hidden}
        .login-header{background:linear-gradient(135deg,var(--juh-red) 0%,var(--juh-dark-red) 100%);color:#fff;padding:2.5rem 2rem;text-align:center}
        .login-header .logo-icon{width:80px;height:80px;background:#fff;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;font-weight:800;font-size:36px;color:var(--juh-red);margin-bottom:1rem;box-shadow:0 4px 12px rgba(0,0,0,.2)}
        .login-header h1{font-size:1.8rem;margin-bottom:.5rem}
        .login-header p{opacity:.95;font-size:1rem}
        .login-body{padding:2rem}
        .form-group{margin-bottom:1.5rem}
        .form-label{display:block;font-weight:600;margin-bottom:.5rem;color:var(--text-dark)}
        .form-label.required::after{content:' *';color:var(--juh-red)}
        .form-input,.form-select,.form-textarea{width:100%;padding:.875rem;border:2px solid var(--juh-border);border-radius:8px;font-size:1rem;font-family:'Barlow',sans-serif;transition:all .3s ease}
        .form-textarea{min-height:100px;resize:vertical}
        .form-input:focus,.form-select:focus,.form-textarea:focus{outline:0;border-color:var(--juh-red);box-shadow:0 0 0 3px rgba(227,6,19,.1)}
        .btn{padding:.875rem 1.5rem;border:none;border-radius:8px;font-weight:600;font-size:1rem;cursor:pointer;transition:all .3s ease;display:inline-flex;align-items:center;justify-content:center;gap:.5rem;font-family:'Barlow',sans-serif}
        .btn-primary{background:var(--juh-red);color:#fff;box-shadow:0 2px 8px rgba(227,6,19,.3)}
        .btn-primary:hover:not(:disabled){background:var(--juh-dark-red);transform:translateY(-1px);box-shadow:0 4px 12px rgba(227,6,19,.4)}
        .btn-primary:disabled{opacity:.6;cursor:not-allowed}
        .btn-secondary{background:var(--juh-gray);color:#fff}
        .btn-secondary:hover{background:#3a3a3a}
        .btn-success{background:var(--success);color:#fff}
        .btn-success:hover{background:#218838}
        .btn-danger{background:#dc3545;color:#fff}
        .btn-danger:hover{background:#c82333}
        .btn-google{background:#fff;color:var(--text-dark);border:2px solid var(--juh-border);margin-top:1rem;width:100%}
        .btn-google:hover{border-color:var(--juh-red);background:var(--juh-light-gray)}
        .divider{display:flex;align-items:center;text-align:center;margin:1.5rem 0;color:var(--text-light)}
        .divider::before,.divider::after{content:'';flex:1;border-bottom:1px solid var(--juh-border)}
        .divider span{padding:0 1rem;font-size:.9rem}
        .error-message,.success-message{padding:.875rem;border-radius:8px;margin-bottom:1rem;font-size:.9rem}
        .error-message{background:#f8d7da;border:1px solid #f5c6cb;color:#721c24}
        .success-message{background:#d4edda;border:1px solid #c3e6cb;color:#155724}
        .container{max-width:1600px;margin:0 auto;padding:0}
        .header{background:linear-gradient(135deg,var(--juh-red) 0%,var(--juh-dark-red) 100%);color:#fff;padding:1.5rem 2rem;box-shadow:0 4px 20px rgba(227,6,19,.3)}
        .header-content{display:flex;justify-content:space-between;align-items:center;max-width:1600px;margin:0 auto;flex-wrap:wrap;gap:1rem}
        .logo-section{display:flex;align-items:center;gap:1rem}
        .logo-icon{width:50px;height:50px;background:#fff;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:24px;color:var(--juh-red);font-family:'Roboto Condensed',sans-serif}
        .header-title h1{font-size:1.8rem;font-weight:800}
        .header-title .subtitle{font-size:.9rem;opacity:.95}
        .header-actions{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}
        .user-info{display:flex;align-items:center;gap:1rem;background:rgba(255,255,255,.1);padding:.75rem 1.25rem;border-radius:8px}
        .user-email{font-size:.9rem}.admin-badge{background:var(--admin-gold);color:#000;padding:.25rem .75rem;border-radius:12px;font-size:.8rem;font-weight:700;margin-left:.5rem}
        .btn-logout{background:rgba(255,255,255,.2);color:#fff;padding:.5rem 1rem;border:1px solid rgba(255,255,255,.3);border-radius:6px;font-size:.9rem;cursor:pointer;transition:all .2s ease}
        .btn-logout:hover{background:rgba(255,255,255,.3)}
        .btn-header{background:#fff;color:var(--juh-red);padding:.75rem 1.5rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all .2s ease}
        .btn-header:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(255,255,255,.3)}
        .nav-tabs{background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.08);padding:0 2rem;display:flex;gap:.5rem;overflow-x:auto}
        .nav-tab{padding:1rem 1.5rem;border:none;background:0 0;color:var(--text-light);font-weight:600;cursor:pointer;position:relative;transition:all .3s ease;white-space:nowrap;font-family:'Barlow',sans-serif;font-size:.95rem}
        .nav-tab:hover{color:var(--juh-red)}
        .nav-tab.active{color:var(--juh-red)}
        .nav-tab.active::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:var(--juh-red)}
        .main-content{padding:2rem}
        .card{background:#fff;border-radius:12px;padding:1.5rem;box-shadow:0 2px 12px rgba(0,0,0,.06);margin-bottom:1.5rem}
        .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:2px solid var(--juh-light-gray);flex-wrap:wrap;gap:1rem}
        .card-title{font-size:1.4rem;font-weight:700;color:var(--text-dark)}
        .card-actions{display:flex;gap:.5rem;flex-wrap:wrap}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem}
        .stat-card{background:#fff;border-radius:12px;padding:1.5rem;box-shadow:0 2px 12px rgba(0,0,0,.06);border-left:4px solid var(--juh-red)}
        .stat-value{font-size:2.5rem;font-weight:800;color:var(--juh-red);margin-bottom:.5rem}
        .stat-label{font-size:.9rem;color:var(--text-light);font-weight:600;text-transform:uppercase}
        .table-container{overflow-x:auto;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.1)}
        .table{width:100%;border-collapse:collapse;background:#fff}
        .table thead{background:linear-gradient(135deg,var(--juh-red) 0%,var(--juh-dark-red) 100%);color:#fff}
        .table th{padding:1rem;text-align:left;font-weight:700;font-size:.9rem}
        .table td{padding:1rem;border-bottom:1px solid var(--juh-border);font-size:.95rem}
        .table tbody tr:hover{background:var(--juh-light-gray)}
        .badge{display:inline-block;padding:.35rem .75rem;border-radius:20px;font-size:.8rem;font-weight:600}
        .badge-pflicht{background:#ffe5e7;color:var(--juh-red)}
        .badge-optional{background:#e8f5e9;color:var(--success)}
        .badge-info{background:#e3f2fd;color:var(--info)}
        .badge-geplant{background:#fff3cd;color:#856404}
        .badge-abgeschlossen{background:#d4edda;color:#155724}
        .search-input{flex:1;min-width:250px;padding:.75rem 1rem;border:2px solid var(--juh-border);border-radius:8px;font-size:1rem;font-family:'Barlow',sans-serif}
        .search-input:focus{outline:0;border-color:var(--juh-red)}
        .action-btn{padding:.4rem .8rem;border:none;border-radius:6px;cursor:pointer;font-size:.85rem;font-weight:600;color:#fff;margin:0 .25rem;transition:all .2s ease}
        .action-btn-edit{background:var(--info)}
        .action-btn-delete{background:#dc3545}
        .action-btn-complete{background:var(--success)}
        .action-btn:hover{opacity:.8;transform:translateY(-1px)}
        .search-filter-bar{display:flex;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap}
        .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000;padding:2rem}
        .modal{background:#fff;border-radius:12px;max-width:800px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,.3)}
        .modal-header{padding:1.5rem;border-bottom:2px solid var(--juh-light-gray);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:#fff;z-index:10}
        .modal-title{font-size:1.4rem;font-weight:700;color:var(--juh-red)}
        .modal-close{background:0 0;border:none;font-size:1.5rem;cursor:pointer;color:var(--text-light);padding:.5rem}
        .modal-body{padding:1.5rem}
        .modal-footer{padding:1.5rem;border-top:2px solid var(--juh-light-gray);display:flex;gap:1rem;justify-content:flex-end;position:sticky;bottom:0;background:#fff}
        .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem}
        .form-grid-full{grid-column:1/-1}
        .checkbox-group{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:.75rem;margin-top:.5rem}
        .checkbox-item{display:flex;align-items:center;gap:.5rem;padding:.75rem;background:var(--juh-light-gray);border-radius:6px;cursor:pointer;transition:all .2s ease}
        .checkbox-item:hover{background:#e8e8e8}
        .checkbox-item input[type=checkbox]{width:18px;height:18px;cursor:pointer}
        .checkbox-item label{cursor:pointer;flex:1;font-weight:500}
        .export-options{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-top:1rem}
        .confirm-dialog{max-width:500px}
        .confirm-message{padding:2rem;text-align:center;font-size:1.1rem;line-height:1.6}
        .info-box{margin-top:2rem;padding:1rem;background:var(--juh-light-gray);border-radius:8px;border-left:4px solid var(--info)}
        @media (max-width:768px){
            .header-content{flex-direction:column}
            .main-content{padding:1rem}
            .stats-grid,.form-grid,.checkbox-group,.export-options{grid-template-columns:1fr}
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const firebaseConfig = {
            apiKey: "AIzaSyCf7t6bWBGND3nyxVy-PlO3nhcnimbyFbk",
            authDomain: "planungmoppeds.firebaseapp.com",
            projectId: "planungmoppeds",
            storageBucket: "planungmoppeds.firebasestorage.app",
            messagingSenderId: "258167919062",
            appId: "1:258167919062:web:c6d9f907ccd13a259f1477"
        };
        
        // ========================================
        // ADMIN CONFIGURATION
        // FÃ¼ge hier Admin-Emails hinzu:
        // ========================================
        const ADMIN_EMAILS = [
            'johannes.backhaus@johanniter.de',
            'alexander.hofbauer@johanniter.de'
        ];
        
        const isAdmin = (userEmail) => {
            if (!userEmail) return false;
            return ADMIN_EMAILS.includes(userEmail.toLowerCase());
        };
        // ========================================
        
        let db=null,auth=null,firebaseApp=null;
        const initFirebase=()=>{try{const{initializeApp,getFirestore,getAuth}=window.firebaseModules;firebaseApp=initializeApp(firebaseConfig);db=getFirestore(firebaseApp);auth=getAuth(firebaseApp);console.log('âœ… Firebase initialisiert');return true}catch(error){console.error("Firebase Fehler:",error);return false}};
        const INITIAL_MOTORRAEDER=[{id:'903',kennzeichen:'M-JU 903',marke:'BMW',typ:'R 1200 RT',baujahr:2018,kilometerstand:45000},{id:'904',kennzeichen:'M-JU 904',marke:'BMW',typ:'R 1200 RT',baujahr:2019,kilometerstand:38000},{id:'905',kennzeichen:'M-JU 905',marke:'BMW',typ:'R 1200 RT',baujahr:2020,kilometerstand:25000},{id:'906',kennzeichen:'M-JU 906',marke:'BMW',typ:'R 1200 RT',baujahr:2021,kilometerstand:15000},{id:'mkt1200',kennzeichen:'MKT 1200 RT',marke:'BMW',typ:'R 1200 RT',baujahr:2017,kilometerstand:58000},{id:'mkt800',kennzeichen:'MKT F800 GS',marke:'BMW',typ:'F 800 GS',baujahr:2016,kilometerstand:62000}];
        const INITIAL_FAHRER=[{id:'1',vorname:'Thomas',nachname:'Miklos',email:'thomas.miklos@johanniter.de',telefon:'+49 151 12345678',geburtstag:'1985-03-15'},{id:'2',vorname:'Martin',nachname:'Apel',email:'martin.apel@johanniter.de',telefon:'+49 151 23456789',geburtstag:'1982-07-22'},{id:'3',vorname:'Stefan',nachname:'Brosch',email:'stefan.brosch@johanniter.de',telefon:'+49 151 34567890',geburtstag:'1990-11-08'},{id:'4',vorname:'Michael',nachname:'Eipert',email:'michael.eipert@johanniter.de',telefon:'',geburtstag:''},{id:'5',vorname:'Andreas',nachname:'Wallner',email:'',telefon:'+49 151 56789012',geburtstag:'1988-05-14'},{id:'6',vorname:'Klaus',nachname:'Hofbauer',email:'klaus.hofbauer@johanniter.de',telefon:'',geburtstag:''},{id:'7',vorname:'Alexander',nachname:'v. Gneisenau',email:'alexander.gneisenau@johanniter.de',telefon:'+49 151 78901234',geburtstag:'1992-09-30'},{id:'8',vorname:'Peter',nachname:'Rubner',email:'peter.rubner@johanniter.de',telefon:'+49 151 89012345',geburtstag:'1987-02-18'},{id:'9',vorname:'Johannes',nachname:'Hipf',email:'johannes.hipf@johanniter.de',telefon:'',geburtstag:''},{id:'10',vorname:'Markus',nachname:'Backhaus',email:'',telefon:'+49 151 01234567',geburtstag:'1991-12-25'},{id:'11',vorname:'Daniel',nachname:'BaumÃ¼ller',email:'daniel.baumueller@johanniter.de',telefon:'+49 151 12340987',geburtstag:'1989-06-03'}];
        const EINSATZTYPEN=['Pflichtdienst','Optionaler Dienst','Fachfortbildung','SanitÃ¤tsdienst','Streife','Veranstaltung','Werkstatt'];
        const calculateEinsatzDauer=(zeitVon,zeitBis)=>{if(!zeitVon||!zeitBis)return 0;const[hVon,mVon]=zeitVon.split(':').map(Number);const[hBis,mBis]=zeitBis.split(':').map(Number);let dauer=(hBis*60+mBis)-(hVon*60+mVon);if(dauer<0)dauer+=24*60;return dauer/60};
        const exportEinsatzToCSV=(einsatz,motorraeder,fahrer)=>{const motorraederDetails=einsatz.motorraeder.map(id=>{const m=motorraeder.find(x=>x.id===id);return m?`${m.kennzeichen} (${m.marke} ${m.typ})`:id}).join(', ');const fahrerDetails=einsatz.fahrer.map(id=>{const f=fahrer.find(x=>x.id===id);return f?`${f.vorname} ${f.nachname}`:id}).join(', ');const csv=[['Einsatzplanung - Export'],[],['Datum',new Date(einsatz.datum).toLocaleDateString('de-DE')],['Uhrzeit',`${einsatz.zeitVon} - ${einsatz.zeitBis}`],['Veranstaltung',einsatz.veranstaltung],['Ort',einsatz.ort],['Typ',einsatz.typ],['Status',einsatz.status||'Geplant'],['Kilometer',einsatz.km||0],['Einsatzstunden',calculateEinsatzDauer(einsatz.zeitVon,einsatz.zeitBis).toFixed(2)],[],['MotorrÃ¤der',motorraederDetails],[],['Fahrer',fahrerDetails],[],['Bemerkungen',einsatz.bemerkungen||'-']].map(row=>row.join(';')).join('\n');const blob=new Blob(['\ufeff'+csv],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=`Einsatz_${einsatz.veranstaltung.replace(/\s+/g,'_')}_${new Date(einsatz.datum).toISOString().split('T')[0]}.csv`;link.click()};
        const exportMultipleEinsaetzeToCSV=(einsaetze,motorraeder,fahrer,zeitraumLabel)=>{const header=['Datum','Uhrzeit Von','Uhrzeit Bis','Veranstaltung','Ort','Typ','Status','Kilometer','Einsatzstunden','MotorrÃ¤der','Fahrer','Bemerkungen'];const rows=einsaetze.map(e=>{const motorraederText=e.motorraeder.map(id=>{const m=motorraeder.find(x=>x.id===id);return m?m.kennzeichen:id}).join(', ');const fahrerText=e.fahrer.map(id=>{const f=fahrer.find(x=>x.id===id);return f?`${f.vorname} ${f.nachname}`:id}).join(', ');return[new Date(e.datum).toLocaleDateString('de-DE'),e.zeitVon,e.zeitBis,e.veranstaltung,e.ort,e.typ,e.status||'Geplant',e.km||0,calculateEinsatzDauer(e.zeitVon,e.zeitBis).toFixed(2),motorraederText,fahrerText,e.bemerkungen||'-']});const csv=[[`Einsatzplanung Export - ${zeitraumLabel}`],[],[`Exportiert am: ${new Date().toLocaleDateString('de-DE')} ${new Date().toLocaleTimeString('de-DE')}`],[`Anzahl EinsÃ¤tze: ${einsaetze.length}`],[],header,...rows].map(row=>row.join(';')).join('\n');const blob=new Blob(['\ufeff'+csv],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=`Einsatzplanung_${zeitraumLabel.replace(/\s+/g,'_')}_${new Date().toISOString().split('T')[0]}.csv`;link.click()};
        
        const LoginPage=()=>{const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[error,setError]=useState('');const[loading,setLoading]=useState(false);const handleEmailLogin=async(e)=>{e.preventDefault();setError('');setLoading(true);try{const{signInWithEmailAndPassword}=window.firebaseModules;await signInWithEmailAndPassword(auth,email,password)}catch(error){setError('Anmeldung fehlgeschlagen')}setLoading(false)};const handleGoogleLogin=async()=>{setError('');setLoading(true);try{const{signInWithPopup,GoogleAuthProvider}=window.firebaseModules;const provider=new GoogleAuthProvider();await signInWithPopup(auth,provider)}catch(error){setError('Google-Anmeldung fehlgeschlagen')}setLoading(false)};return(<div className="login-container"><div className="login-box"><div className="login-header"><div className="logo-icon">JUH</div><h1>ğŸï¸ Einsatzplanung</h1><p>Johanniter Unfallhilfe Bayern</p></div><div className="login-body"><h2 style={{marginBottom:'1.5rem',fontSize:'1.3rem'}}>Anmelden</h2>{error&&<div className="error-message">âš ï¸ {error}</div>}<form onSubmit={handleEmailLogin}><div className="form-group"><label className="form-label">E-Mail</label><input type="email" className="form-input" value={email} onChange={(e)=>setEmail(e.target.value)} required disabled={loading}/></div><div className="form-group"><label className="form-label">Passwort</label><input type="password" className="form-input" value={password} onChange={(e)=>setPassword(e.target.value)} required disabled={loading}/></div><button type="submit" className="btn btn-primary" style={{width:'100%'}} disabled={loading}>{loading?'â³ Wird angemeldet...':'ğŸ” Mit E-Mail anmelden'}</button></form><div className="divider"><span>oder</span></div><button className="btn btn-google" onClick={handleGoogleLogin} disabled={loading}><svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>Mit Google anmelden</button></div></div></div>)};
        
        const EinsatzplanungApp=()=>{const[user,setUser]=useState(null);const[authLoading,setAuthLoading]=useState(true);const[activeTab,setActiveTab]=useState('dashboard');const[einsaetze,setEinsaetze]=useState([]);const[motorraeder,setMotorraeder]=useState(INITIAL_MOTORRAEDER);const[fahrer,setFahrer]=useState(INITIAL_FAHRER);const[searchTerm,setSearchTerm]=useState('');const[filterTyp,setFilterTyp]=useState('');const[filterStatus,setFilterStatus]=useState('');const[loading,setLoading]=useState(true);const[showNewEinsatzModal,setShowNewEinsatzModal]=useState(false);const[showFahrerModal,setShowFahrerModal]=useState(false);const[showMotorradModal,setShowMotorradModal]=useState(false);const[showExportModal,setShowExportModal]=useState(false);const[deleteConfirm,setDeleteConfirm]=useState(null);const[editEinsatz,setEditEinsatz]=useState(null);const[editFahrer,setEditFahrer]=useState(null);const[editMotorrad,setEditMotorrad]=useState(null);const userIsAdmin=user?isAdmin(user.email):false;useEffect(()=>{initFirebase();const{onAuthStateChanged}=window.firebaseModules;const unsubscribe=onAuthStateChanged(auth,(user)=>{setUser(user);setAuthLoading(false);if(user){loadSampleData()}});return()=>unsubscribe()},[]);const loadSampleData=()=>{const sampleData=[{id:'1',datum:'2025-04-27',zeitVon:'08:00',zeitBis:'16:00',veranstaltung:'Sternfahrt Kulmbach',ort:'Kulmbach',typ:'Fachfortbildung',motorraeder:['904','905'],fahrer:['8','11'],km:584,status:'Geplant',bemerkungen:'Treffen um 07:30 Uhr am Vereinsheim'},{id:'2',datum:'2025-05-17',zeitVon:'10:00',zeitBis:'13:00',veranstaltung:'36. MÃ¼nchener Motorrad-Corso',ort:'MÃ¼nchen',typ:'Veranstaltung',motorraeder:['903'],fahrer:['8'],km:0,status:'Geplant'},{id:'3',datum:'2025-06-20',zeitVon:'13:00',zeitBis:'23:30',veranstaltung:'Guns n Roses',ort:'Allianz Arena',typ:'Pflichtdienst',motorraeder:['903','904'],fahrer:['8','1'],km:0,status:'Geplant'},{id:'4',datum:'2025-03-15',zeitVon:'14:00',zeitBis:'22:00',veranstaltung:'Winterschulung 2025',ort:'Rosenheim',typ:'Fachfortbildung',motorraeder:['905','906'],fahrer:['2','3'],km:145,status:'Abgeschlossen',bemerkungen:'Erfolgreich abgeschlossen'},{id:'5',datum:'2025-06-22',zeitVon:'08:00',zeitBis:'18:00',veranstaltung:'Tegernsee SanitÃ¤tsdienst',ort:'Tegernsee',typ:'SanitÃ¤tsdienst',motorraeder:['904','905','906'],fahrer:['6','1','11','8'],km:0,status:'Geplant'},{id:'6',datum:'2025-02-20',zeitVon:'09:00',zeitBis:'17:00',veranstaltung:'Fahrsicherheitstraining',ort:'Ingolstadt',typ:'Fachfortbildung',motorraeder:['903','mkt1200'],fahrer:['7','9'],km:230,status:'Abgeschlossen'}];setEinsaetze(sampleData);setLoading(false)};const handleLogout=async()=>{try{const{signOut}=window.firebaseModules;await signOut(auth)}catch(error){console.error('Logout Fehler:',error)}};const toggleEinsatzStatus=(id)=>{if(!userIsAdmin){alert('â›” Keine Berechtigung! Nur Admins kÃ¶nnen den Status Ã¤ndern.');return}setEinsaetze(einsaetze.map(e=>{if(e.id===id){return{...e,status:e.status==='Geplant'?'Abgeschlossen':'Geplant'}}return e}))};const filteredEinsaetze=einsaetze.filter(e=>{const matchesSearch=searchTerm===''||e.veranstaltung.toLowerCase().includes(searchTerm.toLowerCase())||e.ort.toLowerCase().includes(searchTerm.toLowerCase());const matchesFilter=filterTyp===''||e.typ===filterTyp;const matchesStatus=filterStatus===''||e.status===filterStatus;return matchesSearch&&matchesFilter&&matchesStatus});const stats={gesamt:einsaetze.length,geplant:einsaetze.filter(e=>e.status==='Geplant').length,abgeschlossen:einsaetze.filter(e=>e.status==='Abgeschlossen').length,gesamtKM:einsaetze.reduce((sum,e)=>sum+(e.km||0),0),gesamtStunden:einsaetze.reduce((sum,e)=>sum+calculateEinsatzDauer(e.zeitVon,e.zeitBis),0)};if(authLoading){return(<div style={{display:'flex',justifyContent:'center',alignItems:'center',minHeight:'100vh',fontSize:'1.5rem',color:'var(--text-light)'}}>â³ Wird geladen...</div>)}if(!user){return<LoginPage/>}
        
        return(<div className="container"><header className="header"><div className="header-content"><div className="logo-section"><div className="logo-icon">JUH</div><div className="header-title"><h1>ğŸï¸ Motorradgruppe Einsatzplanung</h1><span className="subtitle">Johanniter Unfallhilfe - Bayern</span></div></div><div className="header-actions">{userIsAdmin&&<button className="btn-header" onClick={()=>setShowNewEinsatzModal(true)}>â• Neuer Einsatz</button>}<div className="user-info"><span className="user-email">ğŸ‘¤ {user.email}</span>{userIsAdmin&&<span className="admin-badge">ğŸ‘‘ Admin</span>}<button className="btn-logout" onClick={handleLogout}>ğŸšª Abmelden</button></div></div></div></header><nav className="nav-tabs"><button className={`nav-tab ${activeTab==='dashboard'?'active':''}`} onClick={()=>setActiveTab('dashboard')}>ğŸ“Š Dashboard</button><button className={`nav-tab ${activeTab==='einsaetze'?'active':''}`} onClick={()=>setActiveTab('einsaetze')}>ğŸ“… Einsatzplanung</button><button className={`nav-tab ${activeTab==='motorraeder'?'active':''}`} onClick={()=>setActiveTab('motorraeder')}>ğŸï¸ MotorrÃ¤der</button><button className={`nav-tab ${activeTab==='fahrer'?'active':''}`} onClick={()=>setActiveTab('fahrer')}>ğŸ‘¥ Fahrer</button><button className={`nav-tab ${activeTab==='statistik'?'active':''}`} onClick={()=>setActiveTab('statistik')}>ğŸ“ˆ Statistiken</button></nav><main className="main-content">{activeTab==='dashboard'&&(<div><div className="stats-grid"><div className="stat-card"><div className="stat-value">{stats.gesamt}</div><div className="stat-label">EinsÃ¤tze Gesamt</div></div><div className="stat-card"><div className="stat-value">{stats.geplant}</div><div className="stat-label">Geplante EinsÃ¤tze</div></div><div className="stat-card"><div className="stat-value">{stats.abgeschlossen}</div><div className="stat-label">Abgeschlossen</div></div><div className="stat-card"><div className="stat-value">{stats.gesamtKM.toLocaleString()}</div><div className="stat-label">Kilometer Gesamt</div></div><div className="stat-card"><div className="stat-value">{stats.gesamtStunden.toFixed(1)}</div><div className="stat-label">Einsatzstunden</div></div></div><div className="card"><div className="card-header"><h2 className="card-title">NÃ¤chste EinsÃ¤tze</h2></div><div className="table-container"><table className="table"><thead><tr><th>Datum</th><th>Veranstaltung</th><th>Ort</th><th>Typ</th><th>Status</th><th>Fahrer</th><th>Dauer</th></tr></thead><tbody>{einsaetze.filter(e=>e.status==='Geplant').slice(0,5).map(einsatz=>(<tr key={einsatz.id}><td>{new Date(einsatz.datum).toLocaleDateString('de-DE')}</td><td><strong>{einsatz.veranstaltung}</strong></td><td>{einsatz.ort}</td><td><span className={`badge ${einsatz.typ==='Pflichtdienst'?'badge-pflicht':einsatz.typ==='Optionaler Dienst'?'badge-optional':'badge-info'}`}>{einsatz.typ}</span></td><td><span className="badge badge-geplant">{einsatz.status}</span></td><td>{einsatz.fahrer.map(id=>{const f=fahrer.find(x=>x.id===id);return f?`${f.vorname} ${f.nachname}`:id}).join(', ')}</td><td>{calculateEinsatzDauer(einsatz.zeitVon,einsatz.zeitBis).toFixed(1)}h</td></tr>))}</tbody></table></div></div></div>)}{activeTab==='einsaetze'&&(<div className="card"><div className="card-header"><h2 className="card-title">Alle EinsÃ¤tze</h2><div className="card-actions"><button className="btn btn-success" onClick={()=>setShowExportModal(true)}>ğŸ“Š Gesamtexport</button>{userIsAdmin&&<button className="btn btn-primary" onClick={()=>setShowNewEinsatzModal(true)}>â• Neuer Einsatz</button>}</div></div><div className="search-filter-bar"><input type="text" className="search-input" placeholder="ğŸ” Suche nach Veranstaltung oder Ort..." value={searchTerm} onChange={(e)=>setSearchTerm(e.target.value)}/><select className="form-select" value={filterTyp} onChange={(e)=>setFilterTyp(e.target.value)} style={{maxWidth:'200px'}}><option value="">Alle Typen</option>{EINSATZTYPEN.map(typ=>(<option key={typ} value={typ}>{typ}</option>))}</select><select className="form-select" value={filterStatus} onChange={(e)=>setFilterStatus(e.target.value)} style={{maxWidth:'200px'}}><option value="">Alle Status</option><option value="Geplant">Geplant</option><option value="Abgeschlossen">Abgeschlossen</option></select></div><div className="table-container"><table className="table"><thead><tr><th>Datum</th><th>Veranstaltung</th><th>Ort</th><th>Typ</th><th>Status</th><th>MotorrÃ¤der</th><th>Fahrer</th><th>KM</th><th>Std</th>{userIsAdmin&&<th>Aktionen</th>}</tr></thead><tbody>{filteredEinsaetze.map(einsatz=>(<tr key={einsatz.id}><td>{new Date(einsatz.datum).toLocaleDateString('de-DE')}</td><td><strong>{einsatz.veranstaltung}</strong></td><td>{einsatz.ort}</td><td><span className={`badge ${einsatz.typ==='Pflichtdienst'?'badge-pflicht':einsatz.typ==='Optionaler Dienst'?'badge-optional':'badge-info'}`}>{einsatz.typ}</span></td><td><span className={`badge ${einsatz.status==='Geplant'?'badge-geplant':'badge-abgeschlossen'}`}>{einsatz.status}</span></td><td>{einsatz.motorraeder.map(id=>{const m=motorraeder.find(x=>x.id===id);return m?m.kennzeichen:id}).join(', ')}</td><td>{einsatz.fahrer.map(id=>{const f=fahrer.find(x=>x.id===id);return f?`${f.vorname} ${f.nachname}`:id}).join(', ')}</td><td>{einsatz.km||0}</td><td>{calculateEinsatzDauer(einsatz.zeitVon,einsatz.zeitBis).toFixed(1)}h</td>{userIsAdmin&&<td><button className="action-btn action-btn-complete" onClick={()=>toggleEinsatzStatus(einsatz.id)} title={einsatz.status==='Geplant'?'Als abgeschlossen markieren':'Als geplant markieren'}>{einsatz.status==='Geplant'?'âœ“':'â†º'}</button><button className="action-btn action-btn-edit" onClick={()=>exportEinsatzToCSV(einsatz,motorraeder,fahrer)} title="Als CSV exportieren">ğŸ’¾</button><button className="action-btn action-btn-edit" onClick={()=>{setEditEinsatz(einsatz);setShowNewEinsatzModal(true)}} title="Einsatz bearbeiten">âœï¸</button><button className="action-btn action-btn-delete" onClick={()=>setDeleteConfirm(einsatz.id)} title="Einsatz lÃ¶schen">ğŸ—‘ï¸</button></td>}</tr>))}</tbody></table></div></div>)}{activeTab==='motorraeder'&&(<div className="card"><div className="card-header"><h2 className="card-title">MotorrÃ¤der Verwaltung</h2>{userIsAdmin&&<button className="btn btn-primary" onClick={()=>setShowMotorradModal(true)}>â• Neues Motorrad</button>}</div><div className="table-container"><table className="table"><thead><tr><th>Kennzeichen</th><th>Marke</th><th>Typ</th><th>Baujahr</th><th>KM-Stand</th><th>EinsÃ¤tze</th>{userIsAdmin&&<th>Aktionen</th>}</tr></thead><tbody>{motorraeder.map(motorrad=>{const count=einsaetze.filter(e=>e.motorraeder.includes(motorrad.id)).length;return(<tr key={motorrad.id}><td><strong>{motorrad.kennzeichen}</strong></td><td>{motorrad.marke}</td><td>{motorrad.typ}</td><td>{motorrad.baujahr}</td><td>{motorrad.kilometerstand.toLocaleString()} km</td><td>{count}</td>{userIsAdmin&&<td><button className="action-btn action-btn-edit" onClick={()=>{setEditMotorrad(motorrad);setShowMotorradModal(true)}} title="Motorrad bearbeiten">âœï¸</button><button className="action-btn action-btn-delete" onClick={()=>{if(window.confirm('Motorrad '+motorrad.kennzeichen+' wirklich lÃ¶schen?')){setMotorraeder(motorraeder.filter(m=>m.id!==motorrad.id))}}} title="Motorrad lÃ¶schen">ğŸ—‘ï¸</button></td>}</tr>)})}</tbody></table></div></div>)}{activeTab==='fahrer'&&(<div className="card"><div className="card-header"><h2 className="card-title">Fahrer Verwaltung</h2>{userIsAdmin&&<button className="btn btn-primary" onClick={()=>setShowFahrerModal(true)}>â• Neuer Fahrer</button>}</div><div className="table-container"><table className="table"><thead><tr><th>Name</th><th>E-Mail</th><th>Telefon</th><th>Geburtstag</th><th>EinsÃ¤tze</th>{userIsAdmin&&<th>Aktionen</th>}</tr></thead><tbody>{fahrer.map(f=>{const count=einsaetze.filter(e=>e.fahrer.includes(f.id)).length;return(<tr key={f.id}><td><strong>{f.vorname} {f.nachname}</strong></td><td>{f.email||'-'}</td><td>{f.telefon||'-'}</td><td>{f.geburtstag?new Date(f.geburtstag).toLocaleDateString('de-DE'):'-'}</td><td>{count}</td>{userIsAdmin&&<td><button className="action-btn action-btn-edit" onClick={()=>{setEditFahrer(f);setShowFahrerModal(true)}} title="Fahrer bearbeiten">âœï¸</button><button className="action-btn action-btn-delete" onClick={()=>{if(window.confirm('Fahrer '+f.vorname+' '+f.nachname+' wirklich lÃ¶schen?')){setFahrer(fahrer.filter(x=>x.id!==f.id))}}} title="Fahrer lÃ¶schen">ğŸ—‘ï¸</button></td>}</tr>)})}</tbody></table></div></div>)}{activeTab==='statistik'&&(<div><h2 style={{fontSize:'1.8rem',marginBottom:'2rem',color:'var(--juh-red)'}}>ğŸ“ˆ Detaillierte Statistiken</h2><div className="card"><div className="card-header"><h2 className="card-title">ğŸï¸ Motorrad-Statistiken</h2></div><div className="table-container"><table className="table"><thead><tr><th>Motorrad</th><th>Geplant</th><th>Abgeschlossen</th><th>Gesamt</th><th>Gefahrene KM</th><th>Einsatzstunden</th></tr></thead><tbody>{motorraeder.map(motorrad=>{const motorradEinsaetze=einsaetze.filter(e=>e.motorraeder.includes(motorrad.id));const geplant=motorradEinsaetze.filter(e=>e.status==='Geplant').length;const abgeschlossen=motorradEinsaetze.filter(e=>e.status==='Abgeschlossen').length;const km=motorradEinsaetze.reduce((sum,e)=>sum+(e.km||0),0);const stunden=motorradEinsaetze.reduce((sum,e)=>sum+calculateEinsatzDauer(e.zeitVon,e.zeitBis),0);return(<tr key={motorrad.id}><td><strong>{motorrad.kennzeichen}</strong><br/><small style={{color:'var(--text-light)'}}>{motorrad.marke} {motorrad.typ}</small></td><td>{geplant}</td><td>{abgeschlossen}</td><td><strong>{motorradEinsaetze.length}</strong></td><td>{km.toLocaleString()} km</td><td>{stunden.toFixed(1)} h</td></tr>)})}</tbody></table></div></div><div className="card"><div className="card-header"><h2 className="card-title">ğŸ‘¥ Fahrer-Statistiken</h2></div><div className="table-container"><table className="table"><thead><tr><th>Fahrer</th><th>Geplant</th><th>Abgeschlossen</th><th>Gesamt</th><th>Einsatzstunden</th></tr></thead><tbody>{fahrer.map(f=>{const fahrerEinsaetze=einsaetze.filter(e=>e.fahrer.includes(f.id));const geplant=fahrerEinsaetze.filter(e=>e.status==='Geplant').length;const abgeschlossen=fahrerEinsaetze.filter(e=>e.status==='Abgeschlossen').length;const stunden=fahrerEinsaetze.reduce((sum,e)=>sum+calculateEinsatzDauer(e.zeitVon,e.zeitBis),0);return{...f,geplant,abgeschlossen,gesamt:fahrerEinsaetze.length,stunden}}).sort((a,b)=>b.gesamt-a.gesamt).map(f=>(<tr key={f.id}><td><strong>{f.vorname} {f.nachname}</strong></td><td>{f.geplant}</td><td>{f.abgeschlossen}</td><td><strong>{f.gesamt}</strong></td><td>{f.stunden.toFixed(1)} h</td></tr>))}</tbody></table></div></div></div>)}</main>
        
        {showNewEinsatzModal&&(<div className="modal-overlay" onClick={()=>{setShowNewEinsatzModal(false);setEditEinsatz(null)}}><div className="modal" onClick={(e)=>e.stopPropagation()}><div className="modal-header"><h2 className="modal-title">{editEinsatz?'âœï¸ Einsatz bearbeiten':'â• Neuer Einsatz'}</h2><button className="modal-close" onClick={()=>setShowNewEinsatzModal(false)}>âœ•</button></div><form onSubmit={(e)=>{e.preventDefault();const formData=new FormData(e.target);const selectedMotorraeder=Array.from(formData.getAll('motorraeder'));const selectedFahrer=Array.from(formData.getAll('fahrer'));if(selectedMotorraeder.length===0){alert('Bitte mindestens ein Motorrad auswÃ¤hlen!');return}if(selectedFahrer.length===0){alert('Bitte mindestens einen Fahrer auswÃ¤hlen!');return}const neuerEinsatz={id:editEinsatz?editEinsatz.id:Date.now().toString(),datum:formData.get('datum'),zeitVon:formData.get('zeitVon'),zeitBis:formData.get('zeitBis'),veranstaltung:formData.get('veranstaltung'),ort:formData.get('ort'),typ:formData.get('typ'),motorraeder:selectedMotorraeder,fahrer:selectedFahrer,km:parseInt(formData.get('km'))||0,status:'Geplant',bemerkungen:formData.get('bemerkungen')};if(editEinsatz){setEinsaetze(einsaetze.map(e=>e.id===editEinsatz.id?neuerEinsatz:e))}else{setEinsaetze([...einsaetze,neuerEinsatz])}setShowNewEinsatzModal(false);setEditEinsatz(null);e.target.reset()}}><div className="modal-body"><div className="form-grid"><div className="form-group"><label className="form-label required">Datum</label><input type="date" name="datum" className="form-input" required defaultValue={editEinsatz?.datum||""}/></div><div className="form-group"><label className="form-label required">Uhrzeit Von</label><input type="time" name="zeitVon" className="form-input" required defaultValue={editEinsatz?.zeitVon||""}/></div><div className="form-group"><label className="form-label required">Uhrzeit Bis</label><input type="time" name="zeitBis" className="form-input" required defaultValue={editEinsatz?.zeitBis||""}/></div><div className="form-group"><label className="form-label">Kilometer</label><input type="number" name="km" className="form-input" min="0" defaultValue={editEinsatz?.km||0}/></div></div><div className="form-group"><label className="form-label required">Veranstaltung</label><input type="text" name="veranstaltung" className="form-input" placeholder="Name der Veranstaltung" required defaultValue={editEinsatz?.veranstaltung||""}/></div><div className="form-grid"><div className="form-group"><label className="form-label required">Ort</label><input type="text" name="ort" className="form-input" placeholder="Veranstaltungsort" required defaultValue={editEinsatz?.ort||""}/></div><div className="form-group"><label className="form-label required">Typ</label><select name="typ" className="form-select" required defaultValue={editEinsatz?.typ||""}><option value="">Bitte wÃ¤hlen...</option>{EINSATZTYPEN.map(typ=>(<option key={typ} value={typ}>{typ}</option>))}</select></div></div><div className="form-group"><label className="form-label required">MotorrÃ¤der auswÃ¤hlen</label><div className="checkbox-group">{motorraeder.map(m=>(<div key={m.id} className="checkbox-item"><input type="checkbox" name="motorraeder" value={m.id} id={`motorrad-${m.id}`} defaultChecked={editEinsatz?.motorraeder?.includes(m.id)}/><label htmlFor={`motorrad-${m.id}`}>{m.kennzeichen}</label></div>))}</div></div><div className="form-group"><label className="form-label required">Fahrer auswÃ¤hlen</label><div className="checkbox-group">{fahrer.map(f=>(<div key={f.id} className="checkbox-item"><input type="checkbox" name="fahrer" value={f.id} id={`fahrer-${f.id}`} defaultChecked={editEinsatz?.fahrer?.includes(f.id)}/><label htmlFor={`fahrer-${f.id}`}>{f.vorname} {f.nachname}</label></div>))}</div></div><div className="form-group"><label className="form-label">Bemerkungen</label><textarea name="bemerkungen" className="form-textarea" placeholder="Optional: ZusÃ¤tzliche Informationen..." defaultValue={editEinsatz?.bemerkungen||""}/></div></div><div className="modal-footer"><button type="button" className="btn btn-secondary" onClick={()=>setShowNewEinsatzModal(false)}>Abbrechen</button><button type="submit" className="btn btn-primary">ğŸ’¾ Speichern</button></div></form></div></div>)}
        
        {showExportModal&&(<div className="modal-overlay" onClick={()=>setShowExportModal(false)}><div className="modal" onClick={(e)=>e.stopPropagation()}><div className="modal-header"><h2 className="modal-title">ğŸ“Š Gesamtexport</h2><button className="modal-close" onClick={()=>setShowExportModal(false)}>âœ•</button></div><div className="modal-body"><p style={{marginBottom:'1.5rem',color:'var(--text-light)'}}>WÃ¤hlen Sie einen Zeitraum und Status fÃ¼r den Export:</p><div className="form-group"><label className="form-label">Status-Filter</label><select id="exportStatus" className="form-select" defaultValue="Geplant"><option value="Geplant">Nur Geplante EinsÃ¤tze</option><option value="Abgeschlossen">Nur Abgeschlossene EinsÃ¤tze</option><option value="Alle">Alle EinsÃ¤tze</option></select></div><h3 style={{marginTop:'1.5rem',marginBottom:'1rem',fontSize:'1.1rem',fontWeight:600}}>Schnellauswahl:</h3><div className="export-options"><button className="btn btn-primary" onClick={()=>{const status=document.getElementById('exportStatus').value;const now=new Date();const weekStart=new Date(now);weekStart.setDate(now.getDate()-now.getDay()+1);const weekEnd=new Date(weekStart);weekEnd.setDate(weekStart.getDate()+6);let filtered=einsaetze.filter(e=>new Date(e.datum)>=weekStart&&new Date(e.datum)<=weekEnd);if(status!=='Alle')filtered=filtered.filter(e=>e.status===status);exportMultipleEinsaetzeToCSV(filtered,motorraeder,fahrer,`Diese Woche (${status})`);setShowExportModal(false)}}>ğŸ“… Diese Woche</button><button className="btn btn-primary" onClick={()=>{const status=document.getElementById('exportStatus').value;const now=new Date();const monthStart=new Date(now.getFullYear(),now.getMonth(),1);const monthEnd=new Date(now.getFullYear(),now.getMonth()+1,0);let filtered=einsaetze.filter(e=>new Date(e.datum)>=monthStart&&new Date(e.datum)<=monthEnd);if(status!=='Alle')filtered=filtered.filter(e=>e.status===status);exportMultipleEinsaetzeToCSV(filtered,motorraeder,fahrer,`Dieser Monat (${status})`);setShowExportModal(false)}}>ğŸ“… Dieser Monat</button><button className="btn btn-primary" onClick={()=>{const status=document.getElementById('exportStatus').value;const now=new Date();const yearStart=new Date(now.getFullYear(),0,1);const yearEnd=new Date(now.getFullYear(),11,31);let filtered=einsaetze.filter(e=>new Date(e.datum)>=yearStart&&new Date(e.datum)<=yearEnd);if(status!=='Alle')filtered=filtered.filter(e=>e.status===status);exportMultipleEinsaetzeToCSV(filtered,motorraeder,fahrer,`Dieses Jahr 2025 (${status})`);setShowExportModal(false)}}>ğŸ“… Dieses Jahr</button><button className="btn btn-primary" onClick={()=>{const status=document.getElementById('exportStatus').value;let filtered=status==='Alle'?einsaetze:einsaetze.filter(e=>e.status===status);exportMultipleEinsaetzeToCSV(filtered,motorraeder,fahrer,`Alle EinsÃ¤tze (${status})`);setShowExportModal(false)}}>ğŸ“… Alle EinsÃ¤tze</button></div><h3 style={{marginTop:'1.5rem',marginBottom:'1rem',fontSize:'1.1rem',fontWeight:600}}>Benutzerdefinierter Zeitraum:</h3><div className="form-grid"><div className="form-group"><label className="form-label">Von Datum</label><input type="date" id="exportVon" className="form-input"/></div><div className="form-group"><label className="form-label">Bis Datum</label><input type="date" id="exportBis" className="form-input"/></div></div><button className="btn btn-success" style={{width:'100%',marginTop:'1rem'}} onClick={()=>{const status=document.getElementById('exportStatus').value;const von=document.getElementById('exportVon').value;const bis=document.getElementById('exportBis').value;if(!von||!bis){alert('Bitte beide Datumsfelder ausfÃ¼llen!');return}const vonDate=new Date(von);const bisDate=new Date(bis);if(vonDate>bisDate){alert('Von-Datum muss vor Bis-Datum liegen!');return}let filtered=einsaetze.filter(e=>{const d=new Date(e.datum);return d>=vonDate&&d<=bisDate});if(status!=='Alle')filtered=filtered.filter(e=>e.status===status);const label=`${vonDate.toLocaleDateString('de-DE')} - ${bisDate.toLocaleDateString('de-DE')} (${status})`;exportMultipleEinsaetzeToCSV(filtered,motorraeder,fahrer,label);setShowExportModal(false)}}>ğŸ“Š Zeitraum exportieren</button><div className="info-box"><strong>ğŸ’¡ Hinweis:</strong> Der Export enthÃ¤lt alle Details inklusive MotorrÃ¤der, Fahrer, Kilometer und Einsatzstunden.</div></div><div className="modal-footer"><button className="btn btn-secondary" onClick={()=>setShowExportModal(false)}>SchlieÃŸen</button></div></div></div>)}
        
        {deleteConfirm&&(<div className="modal-overlay" onClick={()=>setDeleteConfirm(null)}><div className="modal confirm-dialog" onClick={(e)=>e.stopPropagation()}><div className="modal-header"><h2 className="modal-title">âš ï¸ Einsatz lÃ¶schen?</h2><button className="modal-close" onClick={()=>setDeleteConfirm(null)}>âœ•</button></div><div className="confirm-message">MÃ¶chten Sie diesen Einsatz wirklich lÃ¶schen?<br/><strong>Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.</strong></div><div className="modal-footer"><button className="btn btn-secondary" onClick={()=>setDeleteConfirm(null)}>Abbrechen</button><button className="btn btn-danger" onClick={()=>{setEinsaetze(einsaetze.filter(e=>e.id!==deleteConfirm));setDeleteConfirm(null)}}>ğŸ—‘ï¸ EndgÃ¼ltig lÃ¶schen</button></div></div></div>)}
        
        {showFahrerModal&&(<div className="modal-overlay" onClick={()=>{setShowFahrerModal(false);setEditFahrer(null)}}><div className="modal" onClick={(e)=>e.stopPropagation()}><div className="modal-header"><h2 className="modal-title">{editFahrer?'âœï¸ Fahrer bearbeiten':'â• Neuer Fahrer'}</h2><button className="modal-close" onClick={()=>{setShowFahrerModal(false);setEditFahrer(null)}}>âœ•</button></div><form onSubmit={(e)=>{e.preventDefault();const formData=new FormData(e.target);const neuerFahrer={id:editFahrer?editFahrer.id:Date.now().toString(),vorname:formData.get('vorname'),nachname:formData.get('nachname'),email:formData.get('email')||'',telefon:formData.get('telefon')||'',geburtstag:formData.get('geburtstag')||''};if(editFahrer){setFahrer(fahrer.map(f=>f.id===editFahrer.id?neuerFahrer:f))}else{setFahrer([...fahrer,neuerFahrer])}setShowFahrerModal(false);setEditFahrer(null);e.target.reset()}}><div className="modal-body"><div className="form-grid"><div className="form-group"><label className="form-label required">Vorname</label><input type="text" name="vorname" className="form-input" required defaultValue={editFahrer?.vorname||''}/></div><div className="form-group"><label className="form-label required">Nachname</label><input type="text" name="nachname" className="form-input" required defaultValue={editFahrer?.nachname||''}/></div></div><div className="form-grid"><div className="form-group"><label className="form-label">E-Mail</label><input type="email" name="email" className="form-input" defaultValue={editFahrer?.email||''}/></div><div className="form-group"><label className="form-label">Telefon</label><input type="tel" name="telefon" className="form-input" placeholder="+49 151 12345678" defaultValue={editFahrer?.telefon||''}/></div><div className="form-group"><label className="form-label">Geburtstag</label><input type="date" name="geburtstag" className="form-input" defaultValue={editFahrer?.geburtstag||''}/></div></div></div><div className="modal-footer"><button type="button" className="btn btn-secondary" onClick={()=>{setShowFahrerModal(false);setEditFahrer(null)}}>Abbrechen</button><button type="submit" className="btn btn-primary">ğŸ’¾ Speichern</button></div></form></div></div>)}
        
        {showMotorradModal&&(<div className="modal-overlay" onClick={()=>{setShowMotorradModal(false);setEditMotorrad(null)}}><div className="modal" onClick={(e)=>e.stopPropagation()}><div className="modal-header"><h2 className="modal-title">{editMotorrad?'âœï¸ Motorrad bearbeiten':'â• Neues Motorrad'}</h2><button className="modal-close" onClick={()=>{setShowMotorradModal(false);setEditMotorrad(null)}}>âœ•</button></div><form onSubmit={(e)=>{e.preventDefault();const formData=new FormData(e.target);const neuesMotorrad={id:editMotorrad?editMotorrad.id:Date.now().toString(),kennzeichen:formData.get('kennzeichen'),marke:formData.get('marke'),typ:formData.get('typ'),baujahr:parseInt(formData.get('baujahr')),kilometerstand:parseInt(formData.get('kilometerstand'))};if(editMotorrad){setMotorraeder(motorraeder.map(m=>m.id===editMotorrad.id?neuesMotorrad:m))}else{setMotorraeder([...motorraeder,neuesMotorrad])}setShowMotorradModal(false);setEditMotorrad(null);e.target.reset()}}><div className="modal-body"><div className="form-grid"><div className="form-group"><label className="form-label required">Kennzeichen</label><input type="text" name="kennzeichen" className="form-input" placeholder="M-JU 907" required defaultValue={editMotorrad?.kennzeichen||''}/></div><div className="form-group"><label className="form-label required">Marke</label><input type="text" name="marke" className="form-input" placeholder="BMW" required defaultValue={editMotorrad?.marke||''}/></div></div><div className="form-grid"><div className="form-group"><label className="form-label required">Typ</label><input type="text" name="typ" className="form-input" placeholder="R 1200 RT" required defaultValue={editMotorrad?.typ||''}/></div><div className="form-group"><label className="form-label required">Baujahr</label><input type="number" name="baujahr" className="form-input" min="1990" max="2030" required defaultValue={editMotorrad?.baujahr||new Date().getFullYear()}/></div><div className="form-group"><label className="form-label required">Kilometerstand</label><input type="number" name="kilometerstand" className="form-input" min="0" required defaultValue={editMotorrad?.kilometerstand||0}/></div></div></div><div className="modal-footer"><button type="button" className="btn btn-secondary" onClick={()=>{setShowMotorradModal(false);setEditMotorrad(null)}}>Abbrechen</button><button type="submit" className="btn btn-primary">ğŸ’¾ Speichern</button></div></form></div></div>)}
        
        </div>)};
        
        ReactDOM.render(<EinsatzplanungApp/>,document.getElementById('root'));
        console.log('âœ… App gerendert - Version 3.0 KOMPLETT');
    </script>
</body>
</html>
